{"version":3,"sources":["../src/providers.ts","../src/utils/utils.ts","../src/client.ts","../src/tools/create-tool.ts","../src/agent.ts"],"names":["createProvider","config","model","provider","Providers","randomId","hyperid","parseTemplate","template","context","match","key","stripModelName","modelString","parts","stripProviderName","hasTag","content","tag","stripTag","openTagRegex","closeTagRegex","extractInnerTag","regex","isBufferString","str","slugify","text","takeRight","array","n","Defaults","Micro","options","providerConfig","providerFn","axios","prompt","msg","limit","systemPromptMessage","restOfMessages","limitMessages","limitedHistory","messages","bufferString","parsedPrompt","requestBody","tool","thinkingBudgetMap","response","toolName","toolArguments","t","errorMessage","parsedArgs","result","error","toolCalls","toolCall","startTime","responseData","message","latencyMs","reasoning","hasThoughts","errorResponse","createTool","name","description","schema","executeFn","jsonSchema","zodToJsonSchema","properties","required","SYSTEM_PROMPT","dedent","AgentDefaults","Agent","_Agent","agents","agent","z","tools","Orchestrator","_Orchestrator"],"mappings":"gLAMO,SAASA,CAAAA,CAAeC,CAAAA,CAG7B,CACA,GAAM,CAAE,MAAAC,CAAAA,CAAO,GAAGC,CAAS,CAAA,CAAIF,CAAAA,CAC/B,OAAO,CAAE,QAAA,CAAAE,EAAU,KAAA,CAAAD,CAAM,CAC3B,CAMO,IAAME,EAAY,CACvB,MAAA,CAAQ,CAACF,CAAAA,CAAQ,cAAA,IAA8B,CAC7C,MAAA,CAAQ,OAAA,CAAQ,IAAI,cAAA,EAAkB,EAAA,CACtC,QAAS,OAAA,CAAQ,GAAA,CAAI,iBAAmB,2BAAA,CACxC,KAAA,CAAAA,CACF,CAAA,CAAA,CAEA,IAAA,CAAM,CAACA,CAAAA,CAAQ,kCAAA,IAAkD,CAC/D,MAAA,CAAQ,OAAA,CAAQ,IAAI,YAAA,EAAgB,EAAA,CACpC,QAAS,OAAA,CAAQ,GAAA,CAAI,eAAiB,gCAAA,CACtC,KAAA,CAAAA,CACF,CAAA,CAAA,CAEA,MAAA,CAAQ,CAACA,CAAAA,CAAQ,uBAAA,IAAuC,CACtD,MAAA,CAAQ,OAAA,CAAQ,IAAI,cAAA,EAAkB,EAAA,CACtC,QACE,OAAA,CAAQ,GAAA,CAAI,iBACZ,yDAAA,CACF,KAAA,CAAAA,CACF,CAAA,CAAA,CAEA,KAAA,CAAO,CAACA,CAAAA,CAAQ,aAAA,IAA6B,CAC3C,MAAA,CAAQ,OAAA,CAAQ,IAAI,cAAA,EAAkB,EAAA,CACtC,OAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,eAAA,EAAmB,wBACxC,KAAA,CAAAA,CACF,GAEA,UAAA,CAAY,CAACA,EAAQ,4BAAA,IAA4C,CAC/D,OAAQ,OAAA,CAAQ,GAAA,CAAI,oBAAsB,EAAA,CAC1C,OAAA,CAAS,QAAQ,GAAA,CAAI,mBAAA,EAAuB,+BAC5C,KAAA,CAAAA,CACF,GAEA,QAAA,CAAU,CAACA,EAAQ,eAAA,IAA+B,CAChD,OAAQ,OAAA,CAAQ,GAAA,CAAI,kBAAoB,EAAA,CACxC,OAAA,CAAS,QAAQ,GAAA,CAAI,iBAAA,EAAqB,8BAC1C,KAAA,CAAAA,CACF,GAEA,IAAA,CAAM,CAACA,EAAQ,aAAA,IAA6B,CAC1C,MAAA,CAAQ,OAAA,CAAQ,GAAA,CAAI,YAAA,EAAgB,GACpC,OAAA,CAAS,OAAA,CAAQ,IAAI,aAAA,EAAiB,qBAAA,CACtC,MAAAA,CACF,CAAA,CACF,ECzDO,SAASG,CAAAA,EAAmB,CAEjC,OADWC,CAAAA,CAAQ,CAAE,OAAA,CAAS,IAAK,CAAC,CAAA,EAEtC,CAQO,SAASC,CAAAA,CACdC,EACAC,CAAAA,CAA+B,GACvB,CACR,OAAOD,EAAS,OAAA,CAAQ,gBAAA,CAAkB,CAACE,CAAAA,CAAOC,CAAAA,GACzCF,EAAQE,CAAG,CAAA,GAAM,OAAY,MAAA,CAAOF,CAAAA,CAAQE,CAAG,CAAC,CAAA,CAAID,CAC5D,CACH,CAOO,SAASE,EAAeC,CAAAA,CAA6B,CAC1D,IAAMC,CAAAA,CAAQD,CAAAA,CAAY,MAAM,GAAG,CAAA,CACnC,OAAOC,CAAAA,CAAM,MAAA,CAAS,EAAKA,CAAAA,CAAM,CAAC,GAAKD,CAAAA,CAAeA,CACxD,CAOO,SAASE,CAAAA,CAAkBF,EAA6B,CAC7D,IAAMC,EAAQD,CAAAA,CAAY,KAAA,CAAM,GAAG,CAAA,CACnC,OAAOC,EAAM,MAAA,CAAS,CAAA,CAAKA,EAAM,CAAC,CAAA,EAAK,GAAM,EAC/C,CAQO,SAASE,CAAAA,CAAOC,CAAAA,CAAiBC,CAAAA,CAAsB,CAE5D,OADc,IAAI,OAAO,CAAA,CAAA,EAAIA,CAAG,IAAK,GAAG,CAAA,CAC3B,KAAKD,CAAO,CAC3B,CAQO,SAASE,CAAAA,CAASF,EAAiBC,CAAAA,CAAqB,CAC7D,IAAME,CAAAA,CAAe,IAAI,OAAO,CAAA,CAAA,EAAIF,CAAG,IAAK,IAAI,CAAA,CAC1CG,EAAgB,IAAI,MAAA,CAAO,KAAKH,CAAG,CAAA,CAAA,CAAA,CAAK,IAAI,CAAA,CAClD,OAAOD,EAAQ,OAAA,CAAQG,CAAAA,CAAc,EAAE,CAAA,CAAE,OAAA,CAAQC,EAAe,EAAE,CACpE,CAQO,SAASC,CAAAA,CAAgBL,CAAAA,CAAiBC,CAAAA,CAAqB,CACpE,IAAMK,EAAQ,IAAI,MAAA,CAAO,IAAIL,CAAG,CAAA,QAAA,EAAWA,CAAG,CAAA,CAAA,CAAA,CAAK,IAAI,EACjDR,CAAAA,CAAQO,CAAAA,CAAQ,MAAMM,CAAK,CAAA,CACjC,OAAOb,CAAAA,EAASA,CAAAA,CAAM,CAAC,CAAA,CAAIA,CAAAA,CAAM,CAAC,CAAA,CAAE,IAAA,GAAS,EAC/C,CAOO,SAASc,CAAAA,CAAeC,CAAAA,CAAsB,CACnD,OAAOA,CAAAA,CAAI,WAAW,OAAO,CAAA,EAAKA,EAAI,QAAA,CAAS,UAAU,CAC3D,CAqBO,SAASC,EAAQC,CAAAA,CAAsB,CAC5C,OAAOA,CAAAA,CACJ,WAAA,EAAY,CACZ,MAAK,CACL,OAAA,CAAQ,YAAa,EAAE,CAAA,CACvB,QAAQ,UAAA,CAAY,GAAG,EACvB,OAAA,CAAQ,UAAA,CAAY,EAAE,CAC3B,CAQO,SAASC,CAAAA,CAAaC,CAAAA,CAAYC,EAAY,CAAA,CAAQ,CAC3D,OAAIA,CAAAA,EAAK,CAAA,CAAU,EAAC,CAChBA,CAAAA,EAAKD,EAAM,MAAA,CAAe,CAAC,GAAGA,CAAK,CAAA,CAChCA,EAAM,KAAA,CAAM,CAACC,CAAC,CACvB,KCxGMC,CAAAA,CAAW,CACf,OAAQ,OAAA,CAAQ,GAAA,CAAI,cAAA,EAAkB,EAAA,CACtC,OAAA,CAAS,OAAA,CAAQ,IAAI,eAAA,EAAmB,2BAAA,CACxC,aAAc,QAAA,CACd,KAAA,CAAO,cACP,WAAA,CAAa,CAAA,CACb,gCAAiC,mBACnC,CAAA,CAEaC,EAAN,KAAY,CACT,cACA,KAAA,CACA,YAAA,CACA,SACA,OAAA,CACA,MAAA,CACA,UACA,WAAA,CACA,KAAA,CACA,YACA,SAAA,CACA,kBAAA,CACA,gBACA,SAAA,CACA,YAAA,CACA,WACA,OAAA,CACA,gBAAA,CAEA,WACA,SAAA,CACA,SAAA,CACA,eACA,OAAA,CACA,UAAA,CAEA,MAEA,SAAA,CACA,gBAAA,CACA,oBACA,iBAAA,CACA,SAAA,CACA,eACA,KAAA,CACA,mBAAA,CACA,QAER,WAAA,CAAYC,CAAAA,CAAwB,EAAC,CAAG,CACtC,KAAK,UAAA,CAAa5B,CAAAA,GAClB,IAAA,CAAK,OAAA,CAAU4B,GAAS,OAAA,CAExB,IAAA,CAAK,UAAYrB,CAAAA,CAAeqB,CAAAA,EAAS,OAAS,EAAE,CAAA,EAAKF,EAAS,KAAA,CAClE,IAAA,CAAK,aACHhB,CAAAA,CAAkBkB,CAAAA,EAAS,OAAS,EAAE,CAAA,EAAKF,EAAS,YAAA,CAEtD,IAAIG,EACJ,GAAI,IAAA,CAAK,aAAc,CACrB,IAAMC,EAAa/B,CAAAA,CAAU,IAAA,CAAK,YAAsC,CAAA,CACpE+B,CAAAA,GACFD,CAAAA,CAAiBC,CAAAA,CAAW,IAAA,CAAK,SAAS,GAE9C,CAcA,GAZA,KAAK,eAAA,CAAkB,CACrB,QACED,CAAAA,EAAgB,OAAA,EAChBD,GAAS,QAAA,EAAU,OAAA,EACnBF,EAAS,OAAA,CACX,MAAA,CACEG,GAAgB,MAAA,EAAUD,CAAAA,EAAS,UAAU,MAAA,EAAUF,CAAAA,CAAS,OAClE,GAAIE,CAAAA,EAAS,UAAU,OAAA,EAAW,CAChC,QAASA,CAAAA,CAAQ,QAAA,CAAS,OAC5B,CACF,CAAA,CAEI,CAAC,IAAA,CAAK,eAAA,CAAgB,OACxB,MAAM,IAAI,MAAM,qBAAqB,CAAA,CAGvC,KAAK,aAAA,CAAgBG,CAAAA,CAAM,MAAA,CAAO,CAChC,OAAA,CAAS,IAAA,CAAK,gBAAgB,OAAA,CAC9B,OAAA,CAAS,CACP,aAAA,CAAe,CAAA,OAAA,EAAU,KAAK,eAAA,CAAgB,MAAM,GACpD,cAAA,CAAgB,kBAAA,CAChB,GAAG,IAAA,CAAK,eAAA,CAAgB,OAC1B,CAAA,CACA,GAAI,KAAK,OAAA,EAAW,CAClB,QAAS,IAAA,CAAK,OAChB,CACF,CAAC,CAAA,CAED,KAAK,KAAA,CAAQ,IAAA,CAAK,UAClB,IAAA,CAAK,YAAA,CAAeH,GAAS,YAAA,EAAgB,EAAA,CAC7C,KAAK,MAAA,CAASA,CAAAA,EAAS,QAAU,EAAA,CAEjC,IAAA,CAAK,QAAUA,CAAAA,CAAQ,OAAA,EAAW,EAAC,CACnC,IAAA,CAAK,kBAAA,CAAqB,KAAK,YAAA,CAC3B1B,CAAAA,CAAc,KAAK,YAAA,CAAc,IAAA,CAAK,OAAO,CAAA,CAC7C,EAAA,CACJ,KAAK,SAAA,CAAY0B,CAAAA,CAAQ,UACzB,IAAA,CAAK,WAAA,CACHA,EAAQ,WAAA,GAAgB,MAAA,CACpBA,EAAQ,WAAA,CACRF,CAAAA,CAAS,YACf,IAAA,CAAK,KAAA,CAAQE,EAAQ,KAAA,CACrB,IAAA,CAAK,YAAcA,CAAAA,CAAQ,WAAA,CAE3B,KAAK,KAAA,CAAQA,CAAAA,EAAS,OAAS,KAAA,CAC/B,IAAA,CAAK,UAAYA,CAAAA,EAAS,SAAA,EAAa,MAEvC,IAAA,CAAK,SAAA,CAAYA,GAAS,SAAA,EAAa,IAAA,CACvC,IAAA,CAAK,gBAAA,CAAmBA,CAAAA,CAAQ,gBAAA,EAAoB,SAEpD,IAAA,CAAK,SAAA,CAAY,KAAK,KAAA,EAAO,WAAA,IAAe,QAAA,CAAS,OAAO,EAC5D,IAAA,CAAK,iBAAA,CACH,KAAK,KAAA,EAAO,WAAA,IAAe,QAAA,CAAS,IAAI,GACxC,IAAA,CAAK,KAAA,EAAO,aAAY,EAAG,QAAA,CAAS,IAAI,CAAA,EACxC,IAAA,CAAK,OAAO,WAAA,EAAY,EAAG,SAAS,IAAI,CAAA,EACxC,KAAK,SAAA,CAEP,IAAA,CAAK,oBAAsB,IAAA,CAAK,KAAA,EAAO,aAAY,EAAG,QAAA,CAAS,YAAY,CAAA,CAE3E,IAAA,CAAK,cAAA,CAAiB,IAAA,CAAK,KAAA,EAAO,WAAA,IAAe,QAAA,CAAS,QAAQ,EAClE,IAAA,CAAK,KAAA,CAAQ,KAAK,KAAA,EAAO,WAAA,IAAe,QAAA,CAAS,KAAK,EACtD,IAAA,CAAK,mBAAA,CACH,KAAK,KAAA,EAAO,WAAA,IAAe,QAAA,CAAS,mBAAmB,GACvD,IAAA,CAAK,KAAA,EAAO,aAAY,EAAG,QAAA,CAAS,aAAa,CAAA,CACnD,IAAA,CAAK,QAAU,IAAA,CAAK,KAAA,EAAO,aAAY,EAAG,QAAA,CAAS,OAAO,CAAA,CAE1D,IAAA,CAAK,iBACH,IAAA,CAAK,mBAAA,EACL,KAAK,iBAAA,EACL,IAAA,CAAK,cAAA,EACL,IAAA,CAAK,KAAA,EACL,IAAA,CAAK,qBACL,IAAA,CAAK,OAAA,CAEP,KAAK,UAAA,CAAaA,CAAAA,CAAQ,YAAc,MAAA,CACxC,IAAA,CAAK,UAAYA,CAAAA,CAAQ,SAAA,EAAa,OACtC,IAAA,CAAK,SAAA,CAAYA,EAAQ,SAAA,EAAa,MAAA,CACtC,KAAK,cAAA,CAAiBA,CAAAA,CAAQ,gBAAkB,MAAA,CAChD,IAAA,CAAK,QAAUA,CAAAA,CAAQ,OAAA,EAAW,OAClC,IAAA,CAAK,UAAA,CAAaA,EAAQ,UAAA,EAAc,MAAA,CAExC,KAAK,QAAA,CAAWA,CAAAA,EAAS,UAAY,EAAC,CACtC,KAAK,eAAA,CAAgB,IAAA,CAAK,kBAAkB,CAAA,CAExC,IAAA,CAAK,KAAA,GACP,OAAA,CAAQ,GAAA,CAAI;AAAA,6CAAA,CAAiD,CAAA,CAC7D,OAAA,CAAQ,GAAA,CAAI,aAAa,EACzB,OAAA,CAAQ,GAAA,CAAI,+CAA+C,CAAA,CAC3D,QAAQ,GAAA,CAAI,mBAAA,CAAqB,IAAA,CAAK,UAAU,EAChD,OAAA,CAAQ,GAAA,CAAI,mBAAA,CAAqB,IAAA,CAAK,SAAS,CAAA,CAC/C,OAAA,CAAQ,GAAA,CAAI,oBAAqB,IAAA,CAAK,YAAY,CAAA,CAClD,OAAA,CAAQ,IAAI,mBAAA,CAAqB,IAAA,CAAK,eAAe,CAAA,CACrD,QAAQ,GAAA,CAAI,CAAA;AAAA,CAAiD,CAAA,EAEjE,CAEO,WAAA,EAAwB,CAC7B,OAAO,CACL,EAAA,CAAI,IAAA,CAAK,UAAA,CACT,MAAA,CAAQ,IAAA,CAAK,MAAA,CACb,aAAc,IAAA,CAAK,YAAA,CACnB,KAAA,CAAO,IAAA,CAAK,SAAA,CACZ,MAAA,CAAQ,CACN,SAAA,CAAW,CAAA,CACX,cAAA,CAAgB,CAClB,CAAA,CACA,SAAA,CAAW,IAAI,IAAA,EAAK,CAAE,WAAA,EAAY,CAClC,OAAA,CAAS,IAAA,CAAK,QACd,GAAI,IAAA,CAAK,gBAAA,EAAoB,CAC3B,kBAAA,CAAoB,IAAA,CAAK,UACzB,gBAAA,CAAkB,IAAA,CAAK,gBAAA,CACvB,gBAAA,CAAkB,IAAA,CAAK,gBACzB,CACF,CACF,CAEO,eAAA,EAA0B,CAC/B,OAAO,IAAA,CAAK,kBACd,CAEO,eAAA,CAAgBI,CAAAA,CAAsB,CACtCA,CAAAA,GACL,IAAA,CAAK,mBAAqB9B,CAAAA,CAAc8B,CAAAA,CAAQ,IAAA,CAAK,OAAO,CAAA,CACxD,IAAA,CAAK,oBAAsB,CAAC,IAAA,CAAK,gBAAA,EAAiB,CAAE,MAAA,EACtD,IAAA,CAAK,SAAS,OAAA,CAAQ,CACpB,IAAA,CAAM,QAAA,CACN,OAAA,CAAS,IAAA,CAAK,kBAChB,CAAC,CAAA,EAEL,CAEQ,gBAAA,EAA8B,CACpC,OAAO,KAAK,QAAA,CAAS,MAAA,CAAQC,CAAAA,EAAQA,CAAAA,CAAI,IAAA,GAAS,QAAQ,CAC5D,CAEQ,oBAAA,EAAkC,CACxC,OAAO,IAAA,CAAK,QAAA,CAAS,MAAA,CAAQA,CAAAA,EAAQA,CAAAA,CAAI,IAAA,GAAS,QAAQ,CAC5D,CAEO,gBAAA,EAAyB,CAC9B,IAAA,CAAK,QAAA,CAAW,GAClB,CAEO,aAAA,CAAcC,EAAgB,CAAA,CAAc,CACjD,IAAMC,CAAAA,CAAsB,IAAA,CAAK,gBAAA,GAC3BC,CAAAA,CAAiB,IAAA,CAAK,oBAAA,EAAqB,CAC3CC,CAAAA,CAAgBd,CAAAA,CAAUa,EAAgBF,CAAK,CAAA,CAC/CI,CAAAA,CAAiB,CAAC,GAAGH,CAAAA,CAAqB,GAAGE,CAAa,CAAA,CAChE,OAAA,IAAA,CAAK,QAAA,CAAWC,CAAAA,CACT,IAAA,CAAK,QACd,CAEO,WAAA,EAAyB,CAC9B,OAAO,IAAA,CAAK,QACd,CAEO,WAAA,CAAYC,CAAAA,CAA2B,CAC5C,IAAA,CAAK,QAAA,CAAWA,EAClB,CAEO,cAAA,CAAeP,CAAAA,CAAgBQ,CAAAA,CAA6B,CACjE,IAAMC,CAAAA,CAAevC,CAAAA,CAAc8B,EAAQ,IAAA,CAAK,OAAO,CAAA,CACvD,IAAA,CAAK,MAAA,CAASS,CAAAA,CAEVD,GAAgBrB,CAAAA,CAAeqB,CAAY,CAAA,CAC7C,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,CACjB,IAAA,CAAM,MAAA,CACN,OAAA,CAAS,CACP,CACE,IAAA,CAAM,OACN,IAAA,CAAMC,CACR,CAAA,CACA,CACE,IAAA,CAAM,WAAA,CACN,UAAW,CACT,GAAA,CAAKD,CACP,CACF,CACF,CACF,CAAC,CAAA,CAED,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,CACjB,IAAA,CAAM,OACN,OAAA,CAASC,CACX,CAAC,CAAA,CAGC,IAAA,CAAK,SAAA,EACP,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,QAAQ,EAEhC,CAEO,mBAAA,CAAoBT,CAAAA,CAAsB,CAC/C,IAAMS,CAAAA,CAAevC,CAAAA,CAAc8B,CAAAA,CAAQ,IAAA,CAAK,OAAO,EAEvD,OAAA,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,CACjB,IAAA,CAAM,WAAA,CACN,QAASS,CACX,CAAC,CAAA,CAEG,IAAA,CAAK,SAAA,EACP,IAAA,CAAK,UAAU,IAAA,CAAK,QAAQ,CAAA,CAGvB,IACT,CAEA,MAAc,aAA4B,CACxC,IAAMC,CAAAA,CAAmB,CACvB,KAAA,CAAO,IAAA,CAAK,MACZ,QAAA,CAAU,IAAA,CAAK,QAAA,CACf,MAAA,CAAQ,IAAA,CAAK,SACf,EAiBA,GAfI,IAAA,CAAK,WAAA,GACPA,CAAAA,CAAY,WAAA,CAAc,IAAA,CAAK,WAAA,CAAA,CAG7B,IAAA,CAAK,SAAA,GACPA,CAAAA,CAAY,UAAA,CAAa,IAAA,CAAK,SAAA,CAAA,CAG5B,IAAA,CAAK,OAAS,IAAA,CAAK,KAAA,CAAM,MAAA,CAAS,CAAA,GACpCA,CAAAA,CAAY,KAAA,CAAQ,KAAK,KAAA,CAAM,GAAA,CAAKC,CAAAA,EAASA,CAAAA,CAAK,MAAM,CAAA,CACpD,KAAK,WAAA,GACPD,CAAAA,CAAY,WAAA,CAAc,IAAA,CAAK,WAAA,CAAA,CAAA,CAI/B,IAAA,CAAK,WAAa,IAAA,CAAK,gBAAA,CACzB,GAAI,IAAA,CAAK,iBAAA,CACPA,CAAAA,CAAY,iBAAmB,IAAA,CAAK,gBAAA,CAChC,IAAA,CAAK,SAAA,GACPA,CAAAA,CAAY,qBAAA,CAAwB,KAAK,SAAA,CACzC,OAAOA,CAAAA,CAAY,UAAA,CAAA,CAAA,KAAA,GAEZ,IAAA,CAAK,mBAAA,CAAqB,CACnC,IAAME,CAAAA,CAAoD,CACxD,OAAA,CAAS,IAAA,CACT,GAAA,CAAK,IAAA,CACL,MAAA,CAAQ,IAAA,CACR,IAAA,CAAM,KACR,CAAA,CACAF,CAAAA,CAAY,UAAA,CAAa,CACvB,MAAA,CAAQ,CACN,eAAA,CAAiB,CACf,eAAA,CACEE,CAAAA,CAAkB,KAAK,gBAAA,EAAoB,QAAQ,CAAA,CACrD,gBAAA,CAAkB,IACpB,CACF,CACF,EACF,CAAA,KAAW,IAAA,CAAK,cAAA,GACdF,CAAAA,CAAY,QAAA,CAAW,CACrB,IAAA,CAAM,SACR,CAAA,CAAA,CAIA,IAAA,CAAK,SAAA,EACP,IAAA,CAAK,UAAUA,CAAW,CAAA,CAG5B,IAAMG,CAAAA,CAAW,MAAM,IAAA,CAAK,cAAc,IAAA,CACxCnB,CAAAA,CAAS,+BAAA,CACTgB,CACF,CAAA,CAEA,OAAI,KAAK,cAAA,EACP,IAAA,CAAK,cAAA,CAAeG,CAAAA,CAAS,IAAI,CAAA,CAG5BA,CAAAA,CAAS,IAClB,CAEA,MAAc,WAAA,CACZC,CAAAA,CACAC,CAAAA,CACc,CACd,IAAMJ,CAAAA,CAAO,IAAA,CAAK,KAAA,EAAO,IAAA,CAAMK,CAAAA,EAAMA,CAAAA,CAAE,OAAO,QAAA,CAAS,IAAA,GAASF,CAAQ,CAAA,CAExE,GAAI,CAACH,EAAM,CACT,IAAMM,CAAAA,CAAe,CAAA,MAAA,EAASH,CAAQ,CAAA,WAAA,CAAA,CACtC,OAAI,IAAA,CAAK,UAAA,EACP,IAAA,CAAK,UAAA,CAAW,CACd,QAAA,CAAAA,EACA,SAAA,CAAWC,CAAAA,CACX,MAAA,CAAQ,IAAA,CACR,KAAA,CAAOE,CACT,CAAC,CAAA,CAEIA,CACT,CAEA,GAAI,CACF,IAAMC,EAAa,IAAA,CAAK,KAAA,CAAMH,CAAa,CAAA,CACrCI,CAAAA,CAAS,MAAMR,CAAAA,CAAK,OAAA,CAAQO,CAAU,CAAA,CAE5C,OAAI,IAAA,CAAK,UAAA,EACP,IAAA,CAAK,WAAW,CACd,QAAA,CAAAJ,CAAAA,CACA,SAAA,CAAWI,CAAAA,CACX,MAAA,CAAAC,CACF,CAAC,CAAA,CAGIA,CACT,CAAA,MAASC,CAAAA,CAAY,CACnB,IAAMH,CAAAA,CAAe,CAAA,sBAAA,EAAyBH,CAAQ,CAAA,GAAA,EAAMM,CAAAA,CAAM,OAAO,GACzE,OAAI,IAAA,CAAK,UAAA,EACP,IAAA,CAAK,UAAA,CAAW,CACd,SAAAN,CAAAA,CACA,SAAA,CAAWC,CAAAA,CACX,MAAA,CAAQ,IAAA,CACR,KAAA,CAAOE,CACT,CAAC,CAAA,CAEIA,CACT,CACF,CAEA,MAAc,gBAAgBI,CAAAA,CAAiC,CAC7D,IAAA,IAAWC,CAAAA,IAAYD,CAAAA,CAAW,CAChC,IAAMP,CAAAA,CAAWQ,CAAAA,CAAS,QAAA,CAAS,IAAA,CAC7BP,CAAAA,CAAgBO,CAAAA,CAAS,SAAS,SAAA,CAElCH,CAAAA,CAAS,MAAM,IAAA,CAAK,WAAA,CAAYL,CAAAA,CAAUC,CAAa,CAAA,CAE7D,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,CACjB,IAAA,CAAM,OACN,YAAA,CAAcO,CAAAA,CAAS,EAAA,CACvB,IAAA,CAAMR,CAAAA,CACN,OAAA,CAAS,OAAOK,CAAAA,EAAW,QAAA,CAAWA,CAAAA,CAAS,IAAA,CAAK,SAAA,CAAUA,CAAM,CACtE,CAAC,EACH,CAEI,IAAA,CAAK,SAAA,EACP,IAAA,CAAK,UAAU,IAAA,CAAK,QAAQ,EAEhC,CAEA,MAAa,MAAA,EAA4B,CACvC,IAAMI,CAAAA,CAAY,IAAA,CAAK,GAAA,EAAI,CAE3B,GAAI,CACF,IAAMC,CAAAA,CAAe,MAAM,IAAA,CAAK,WAAA,EAAY,CAGtCC,CAAAA,CADSD,EAAa,OAAA,GAAU,CAAC,CAAA,EACf,OAAA,CAUxB,GARIC,CAAAA,GACF,KAAK,QAAA,CAAS,IAAA,CAAKA,CAAO,CAAA,CAEtB,IAAA,CAAK,SAAA,EACP,KAAK,SAAA,CAAU,IAAA,CAAK,QAAQ,CAAA,CAAA,CAI5BA,CAAAA,EAAS,UAAA,EAAcA,EAAQ,UAAA,CAAW,MAAA,CAAS,CAAA,CACrD,OAAA,MAAM,IAAA,CAAK,eAAA,CAAgBA,EAAQ,UAAU,CAAA,CACtC,IAAA,CAAK,MAAA,EAAO,CAIrB,IAAMC,EADU,IAAA,CAAK,GAAA,EAAI,CACGH,CAAAA,CAExBI,CAAAA,CAAY,EAAA,CACZ/C,EAAU6C,CAAAA,EAAS,OAAA,EAAW,EAAA,CAC9BG,CAAAA,CAAc,CAAA,CAAA,CAEd,IAAA,CAAK,SAAA,EAAa,IAAA,CAAK,gBAAA,EAAoBhD,CAAAA,GACzCD,CAAAA,CAAOC,CAAAA,CAAS,UAAU,CAAA,EAC5B+C,EAAY1C,CAAAA,CAAgBL,CAAAA,CAAS,UAAU,CAAA,CAC/CA,CAAAA,CAAUE,CAAAA,CAASF,EAAS,UAAU,CAAA,CACtCgD,CAAAA,CAAc,CAAA,CAAA,EACLjD,CAAAA,CAAOC,CAAAA,CAAS,OAAO,CAAA,GAChC+C,CAAAA,CAAY1C,CAAAA,CAAgBL,CAAAA,CAAS,OAAO,CAAA,CAC5CA,EAAUE,CAAAA,CAASF,CAAAA,CAAS,OAAO,CAAA,CACnCgD,CAAAA,CAAc,CAAA,CAAA,CAAA,CAAA,CAIlB,IAAMf,CAAAA,CAAqB,CACzB,QAAA,CAAU,CACR,EAAA,CAAI,IAAA,CAAK,WACT,MAAA,CAAQ,IAAA,CAAK,MAAA,CACb,YAAA,CAAc,IAAA,CAAK,YAAA,CACnB,MAAO,IAAA,CAAK,SAAA,CACZ,UAAA,CAAYW,CAAAA,CAAa,KAAA,CACzB,MAAA,CAAQ,CACN,SAAA,CAAAE,CAAAA,CACA,cAAA,CAAgBA,CAAAA,CAAY,GAC9B,CAAA,CACA,SAAA,CAAW,IAAI,IAAA,EAAK,CAAE,WAAA,EAAY,CAClC,OAAA,CAAS,IAAA,CAAK,QACd,GAAI,IAAA,CAAK,gBAAA,EAAoB,CAC3B,kBAAA,CAAoB,IAAA,CAAK,UACzB,gBAAA,CAAkB,IAAA,CAAK,gBAAA,CACvB,gBAAA,CAAkB,IAAA,CAAK,gBAAA,CACvB,YAAAE,CACF,CACF,CAAA,CACA,UAAA,CAAY,CACV,IAAA,CAAMH,GAAS,IAAA,EAAQ,WAAA,CACvB,OAAA,CAAS7C,CAAAA,CAAQ,IAAA,EAAK,CACtB,UAAW+C,CAAAA,CAAU,IAAA,EAAK,CAC1B,QAAA,CAAUF,CAAAA,EAAS,OAAA,EAAW,EAChC,CACF,CAAA,CAEA,OAAI,IAAA,CAAK,UAAA,EACP,IAAA,CAAK,UAAA,CAAWZ,CAAAA,CAAU,IAAA,CAAK,QAAQ,CAAA,CAGlCA,CACT,CAAA,MAASO,CAAAA,CAAY,CAEnB,IAAMM,CAAAA,CADU,IAAA,CAAK,GAAA,EAAI,CACGH,CAAAA,CAEtBM,EAA0B,CAC9B,QAAA,CAAU,CACR,EAAA,CAAI,IAAA,CAAK,UAAA,CACT,OAAQ,IAAA,CAAK,MAAA,CACb,YAAA,CAAc,IAAA,CAAK,YAAA,CACnB,KAAA,CAAO,KAAK,SAAA,CACZ,MAAA,CAAQ,CACN,SAAA,CAAAH,CAAAA,CACA,cAAA,CAAgBA,EAAY,GAC9B,CAAA,CACA,SAAA,CAAW,IAAI,IAAA,EAAK,CAAE,aAAY,CAClC,OAAA,CAAS,IAAA,CAAK,OAChB,CAAA,CACA,UAAA,CAAY,CACV,IAAA,CAAM,WAAA,CACN,OAAA,CAAS,EAAA,CACT,QAAA,CAAU,EACZ,CAAA,CACA,KAAA,CAAO,CACL,IAAA,CAAMN,CAAAA,CAAM,IAAA,GAAS,cAAA,CAAiB,SAAA,CAAY,YAClD,OAAA,CAASA,CAAAA,CAAM,OAAA,CACf,MAAA,CAAQA,CAAAA,CAAM,QAAA,EAAU,OACxB,IAAA,CAAMA,CAAAA,CAAM,IAAA,CACZ,OAAA,CAASA,CAAAA,CAAM,QAAA,EAAU,IAC3B,CACF,CAAA,CAEA,OAAI,IAAA,CAAK,OAAA,EACP,IAAA,CAAK,QAAQS,CAAAA,CAAc,KAAK,CAAA,CAG3BA,CACT,CACF,CAEA,MAAa,IAAA,CAAK7B,CAAAA,CAAgBQ,CAAAA,CAA0C,CAC1E,OAAA,IAAA,CAAK,cAAA,CAAeR,EAAQQ,CAAY,CAAA,CACjC,IAAA,CAAK,MAAA,EACd,CACF,ECpgBO,SAASsB,CAAAA,CACdC,CAAAA,CACAC,EACAC,CAAAA,CACAC,CAAAA,CACM,CACN,IAAMC,CAAAA,CAAaC,eAAAA,CAAgBH,EAAe,CAChD,MAAA,CAAQ,UAAA,CACR,YAAA,CAAc,MAChB,CAAC,EAEKI,CAAAA,CAAcF,CAAAA,CAAmB,UAAA,EAAc,EAAC,CAChDG,CAAAA,CAAYH,EAAmB,QAAA,EAAY,EAAC,CAElD,OAAO,CACL,MAAA,CAAQ,CACN,IAAA,CAAM,UAAA,CACN,QAAA,CAAU,CACR,IAAA,CAAAJ,CAAAA,CACA,YAAAC,CAAAA,CACA,UAAA,CAAY,CACV,IAAA,CAAM,QAAA,CACN,UAAA,CAAAK,EACA,QAAA,CAAAC,CAAAA,CACA,oBAAA,CAAsB,KACxB,CACF,CACF,CAAA,CACA,OAAA,CAASJ,CACX,CACF,CCpDA,IAAMK,CAAAA,CAAgBC,CAAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CA2BhBC,CAAAA,CAAgB,CACpB,KAAA,CAAO,aACT,CAAA,CAEaC,CAAAA,CAAN,MAAMC,CAAM,CACT,MAAA,CACD,IAAA,CACA,YAAA,CACA,QAAA,CACA,MACA,QAAA,CACA,KAAA,CAEP,WAAA,CAAY/C,CAAAA,CAAuB,CACjC,IAAA,CAAK,IAAA,CAAOA,CAAAA,CAAQ,IAAA,CACpB,IAAA,CAAK,YAAA,CAAeA,CAAAA,CAAQ,YAAA,CAC5B,IAAA,CAAK,SAAWA,CAAAA,CAAQ,QAAA,CACxB,IAAA,CAAK,KAAA,CAAQA,CAAAA,CAAQ,KAAA,EAAS,EAAC,CAC/B,IAAA,CAAK,QAAA,CAAWA,CAAAA,CAAQ,QAAA,CACxB,IAAA,CAAK,KAAA,CAAQA,EAAQ,KAAA,CAErB,IAAMxB,CAAAA,CAAU,CACd,IAAA,CAAMwB,CAAAA,CAAQ,IAAA,CACd,UAAA,CAAYA,CAAAA,CAAQ,YAAA,CACpB,IAAA,CAAMA,CAAAA,CAAQ,YAAA,CACd,sBAAA,CAAwBA,EAAQ,YAAA,CAChC,SAAA,CAAW,CACT,IAAA,CAAK,wBAAA,CAAyB,IAAA,CAAK,QAAA,EAAY,EAAE,CAAA,CACjD,IAAA,CAAK,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAS,EAAE,CACzC,CAAA,CACA,GAAIA,CAAAA,CAAQ,OAAA,EAAW,EACzB,CAAA,CAEA,IAAA,CAAK,MAAA,CAAS,IAAID,CAAAA,CAAM,CACtB,aAAc4C,CAAAA,CACd,SAAA,CAAW3C,CAAAA,CAAQ,SAAA,EAAa,GAAA,CAChC,WAAA,CAAaA,CAAAA,CAAQ,WAAA,EAAe,CAAA,CACpC,KAAA,CAAO,IAAA,CAAK,KAAA,EAAS6C,CAAAA,CAAc,KAAA,CACnC,KAAA,CAAO7C,CAAAA,CAAQ,KAAA,EAAS,KAAA,CACxB,OAAA,CAASxB,CAAAA,CACT,QAAA,CAAUwB,CAAAA,CAAQ,QAAA,CAClB,SAAA,CAAWA,CAAAA,CAAQ,SAAA,CACnB,gBAAA,CAAkBA,CAAAA,CAAQ,gBAAA,CAC1B,OAAA,CAASA,EAAQ,OAAA,CACjB,SAAA,CAAWA,CAAAA,CAAQ,SAAA,CACnB,WAAA,CAAaA,CAAAA,CAAQ,WAAA,CACrB,UAAA,CAAYA,CAAAA,CAAQ,UAAA,CACpB,SAAA,CAAWA,CAAAA,CAAQ,SAAA,CACnB,SAAA,CAAWA,EAAQ,SAAA,CACnB,cAAA,CAAgBA,CAAAA,CAAQ,cAAA,CACxB,OAAA,CAASA,CAAAA,CAAQ,OAAA,CACjB,UAAA,CAAYA,CAAAA,CAAQ,UAAA,CACpB,GAAI,IAAA,CAAK,QAAA,EAAY,IAAA,CAAK,SAAS,MAAA,CAAS,CAAA,CACxC,CACE,KAAA,CAAO,CACL,GAAIA,CAAAA,CAAQ,KAAA,EAAS,EAAC,CACtB,GAAG,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,QAAQ,CAC3C,CACF,CAAA,CACA,CAAE,KAAA,CAAOA,CAAAA,CAAQ,KAAM,CAC7B,CAAC,EACH,CAEQ,mBAAA,CAAoBgD,CAAAA,CAAyB,CACnD,OAAOA,CAAAA,CAAO,GAAA,CAAKC,CAAAA,EACjBf,CAAAA,CACEzC,CAAAA,CAAQwD,CAAAA,CAAM,IAAI,CAAA,CAClB,CAAA,UAAA,EAAaA,CAAAA,CAAM,IAAI,CAAA,mBAAA,EAAsBA,CAAAA,CAAM,YAAY,GAC/DC,CAAAA,CAAE,MAAA,CAAO,CACP,MAAA,CAAQA,CAAAA,CAAE,MAAA,EAAO,CAAE,QAAA,CAAS,4BAA4B,CAC1D,CAAC,CAAA,CACD,MAAO,CAAE,OAAA9C,CAAO,CAAA,GAAM,CACpB,IAAMa,CAAAA,CAAW,MAAMgC,CAAAA,CAAM,IAAA,CAAK7C,CAAM,CAAA,CACxC,OAAOa,CAAAA,EAAU,UAAA,EAAY,OAAA,EAAWA,CAC1C,CACF,CACF,CACF,CAEQ,iBAAA,CAAkBkC,CAAAA,CAAuB,CAC/C,OAAI,CAACA,CAAAA,EAASA,CAAAA,CAAM,MAAA,GAAW,CAAA,CACtB,MAAA,CAGP;AAAA,CAAA,CACAA,CAAAA,CACG,IACEpC,CAAAA,EACC,CAAA,EAAA,EAAKA,EAAK,MAAA,CAAO,QAAA,CAAS,IAAI,CAAA,EAAA,EAAKtB,CAAAA,CAAQsB,CAAAA,CAAK,OAAO,QAAA,CAAS,IAAI,CAAC,CAAA,kBAAA,EACnEA,CAAAA,CAAK,OAAO,QAAA,CAAS,WACvB,CAAA,CACJ,CAAA,CACC,IAAA,CAAK;AAAA,CAAI,CAEhB,CAEQ,wBAAA,CAAyBiC,CAAAA,CAAyB,CACxD,OAAI,CAACA,CAAAA,EAAUA,CAAAA,CAAO,MAAA,GAAW,CAAA,CACxB,MAAA,CAGP;AAAA,CAAA,CACAA,EACG,GAAA,CACEC,CAAAA,EACC,CAAA,EAAA,EAAKA,CAAAA,CAAM,IAAI,CAAA,EAAA,EAAKxD,CAAAA,CAAQwD,CAAAA,CAAM,IAAI,CAAC,CAAA,kBAAA,EACrCA,CAAAA,CAAM,YACR,CAAA,CACJ,EACC,IAAA,CAAK;AAAA,CAAI,CAEhB,CAEA,MAAa,MAAA,EAA4B,CACvC,OAAO,IAAA,CAAK,MAAA,CAAO,MAAA,EACrB,CAEA,MAAa,IAAA,CAAK7C,CAAAA,CAAmC,CACnD,OAAA,IAAA,CAAK,SAAA,CAAUA,CAAM,EACd,IAAA,CAAK,MAAA,CAAO,MAAA,EACrB,CAEO,WAAA,EAAyB,CAC9B,OAAO,IAAA,CAAK,OAAO,WAAA,EACrB,CAEO,SAAA,CAAUC,CAAAA,CAAmB,CAClC,IAAA,CAAK,MAAA,CAAO,cAAA,CAAeA,CAAG,EAChC,CAEO,kBAAA,CAAmBA,CAAAA,CAAmB,CAC3C,IAAA,CAAK,OAAO,mBAAA,CAAoBA,CAAG,EACrC,CAEO,WAAA,EAAwB,CAC7B,OAAO,IAAA,CAAK,MAAA,CAAO,aACrB,CAEA,OAAc,MAAA,CAAOL,CAAAA,CAA8B,CACjD,OAAO,IAAI+C,CAAAA,CAAM/C,CAAO,CAC1B,CACF,CAAA,CAEaoD,CAAAA,CAAN,MAAMC,CAAAA,SAAqBP,CAAM,CACtC,WAAA,CAAY9C,CAAAA,CAAuB,CACjC,KAAA,CAAM,CAAE,GAAGA,CAAAA,CAAS,QAAA,CAAU,cAAe,CAAC,EAChD,CAEA,OAAc,MAAA,CAAOA,CAAAA,CAAqC,CACxD,OAAO,IAAIqD,EAAa,CAAE,GAAGrD,CAAAA,CAAS,QAAA,CAAU,cAAe,CAAC,CAClE,CACF","file":"index.js","sourcesContent":["import type { Provider } from './types'\n\n/**\n * Create a provider configuration object\n * Separates the model from the provider config for internal use\n */\nexport function createProvider(config: Provider): {\n  provider: Omit<Provider, 'model'>\n  model: string\n} {\n  const { model, ...provider } = config\n  return { provider, model }\n}\n\n/**\n * Built-in provider configurations\n * Each provider includes API endpoint, authentication, and default model\n */\nexport const Providers = {\n  openai: (model = 'gpt-4.1-mini'): Provider => ({\n    apiKey: process.env.OPENAI_API_KEY || '',\n    baseURL: process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1',\n    model,\n  }),\n\n  groq: (model = 'moonshotai/kimi-k2-instruct-0905'): Provider => ({\n    apiKey: process.env.GROQ_API_KEY || '',\n    baseURL: process.env.GROQ_BASE_URL || 'https://api.groq.com/openai/v1',\n    model,\n  }),\n\n  gemini: (model = 'gemini-2.5-flash-lite'): Provider => ({\n    apiKey: process.env.GEMINI_API_KEY || '',\n    baseURL:\n      process.env.GEMINI_BASE_URL ||\n      'https://generativelanguage.googleapis.com/v1beta/openai',\n    model,\n  }),\n\n  ai302: (model = 'gpt-4o-mini'): Provider => ({\n    apiKey: process.env.AI_302_API_KEY || '',\n    baseURL: process.env.AI_302_BASE_URL || 'https://api.302.ai/v1',\n    model,\n  }),\n\n  openrouter: (model = 'anthropic/claude-haiku-4.5'): Provider => ({\n    apiKey: process.env.OPENROUTER_API_KEY || '',\n    baseURL: process.env.OPENROUTER_BASE_URL || 'https://openrouter.ai/api/v1',\n    model,\n  }),\n\n  deepseek: (model = 'deepseek-chat'): Provider => ({\n    apiKey: process.env.DEEPSEEK_API_KEY || '',\n    baseURL: process.env.DEEPSEEK_BASE_URL || 'https://api.deepseek.com/v1',\n    model,\n  }),\n\n  grok: (model = 'grok-4-fast'): Provider => ({\n    apiKey: process.env.GROK_API_KEY || '',\n    baseURL: process.env.GROK_BASE_URL || 'https://api.x.ai/v1',\n    model,\n  }),\n}\n","import hyperid from 'hyperid'\n\n/**\n * Generate a random ID using crypto.randomUUID\n */\nexport function randomId(): string {\n  const id = hyperid({ urlSafe: true })\n  return id()\n}\n\n/**\n * Parse template string and replace {{variable}} placeholders with context values\n * @param template - Template string with {{variable}} placeholders\n * @param context - Object containing variable values\n * @returns Parsed string with variables replaced\n */\nexport function parseTemplate(\n  template: string,\n  context: Record<string, any> = {}\n): string {\n  return template.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\n    return context[key] !== undefined ? String(context[key]) : match\n  })\n}\n\n/**\n * Extract model name from \"provider:model\" format\n * @param modelString - Full model string (e.g., \"openai:gpt-4.1-mini\")\n * @returns Model name only (e.g., \"gpt-4o-mini\")\n */\nexport function stripModelName(modelString: string): string {\n  const parts = modelString.split(':')\n  return parts.length > 1 ? (parts[1] ?? modelString) : modelString\n}\n\n/**\n * Extract provider name from \"provider:model\" format\n * @param modelString - Full model string (e.g., \"openai:gpt-4.1-mini\")\n * @returns Provider name only (e.g., \"openai\")\n */\nexport function stripProviderName(modelString: string): string {\n  const parts = modelString.split(':')\n  return parts.length > 1 ? (parts[0] ?? '') : ''\n}\n\n/**\n * Check if content contains a specific XML-style tag\n * @param content - Content to check\n * @param tag - Tag name to look for\n * @returns True if tag is found\n */\nexport function hasTag(content: string, tag: string): boolean {\n  const regex = new RegExp(`<${tag}>`, 'i')\n  return regex.test(content)\n}\n\n/**\n * Remove XML-style tags from content\n * @param content - Content with tags\n * @param tag - Tag name to remove\n * @returns Content without the specified tags\n */\nexport function stripTag(content: string, tag: string): string {\n  const openTagRegex = new RegExp(`<${tag}>`, 'gi')\n  const closeTagRegex = new RegExp(`</${tag}>`, 'gi')\n  return content.replace(openTagRegex, '').replace(closeTagRegex, '')\n}\n\n/**\n * Extract content within XML-style tags\n * @param content - Content with tags\n * @param tag - Tag name to extract\n * @returns Content within the tags, or empty string if not found\n */\nexport function extractInnerTag(content: string, tag: string): string {\n  const regex = new RegExp(`<${tag}>(.*?)</${tag}>`, 'is')\n  const match = content.match(regex)\n  return match && match[1] ? match[1].trim() : ''\n}\n\n/**\n * Check if a string is a base64-encoded buffer string (data URL)\n * @param str - String to check\n * @returns True if string is a buffer string\n */\nexport function isBufferString(str: string): boolean {\n  return str.startsWith('data:') && str.includes(';base64,')\n}\n\n/**\n * Detect MIME type from a buffer string (data URL)\n * @param bufferString - Base64 buffer string\n * @returns MIME type (e.g., \"image/png\") or empty string if not detected\n */\nexport function detectMimeTypeFromBufferString(bufferString: string): string {\n  if (!isBufferString(bufferString)) {\n    return ''\n  }\n\n  const match = bufferString.match(/^data:([^;]+);base64,/)\n  return match && match[1] ? match[1] : ''\n}\n\n/**\n * Convert a string to a URL-friendly slug\n * @param text - Text to slugify\n * @returns Slugified text (lowercase, hyphens, alphanumeric)\n */\nexport function slugify(text: string): string {\n  return text\n    .toLowerCase()\n    .trim()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/[\\s_-]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n}\n\n/**\n * Get the last n elements from an array\n * @param array - Array to take elements from\n * @param n - Number of elements to take from the end\n * @returns New array with the last n elements\n */\nexport function takeRight<T>(array: T[], n: number = 1): T[] {\n  if (n <= 0) return []\n  if (n >= array.length) return [...array]\n  return array.slice(-n)\n}\n","import 'dotenv/config'\nimport axios, { AxiosInstance } from 'axios'\nimport type {\n  MicroOptions,\n  Message,\n  Provider,\n  ReasoningLevel,\n  Metadata,\n  Response,\n} from './types'\nimport { Providers } from './providers'\nimport {\n  randomId,\n  parseTemplate,\n  stripModelName,\n  stripProviderName,\n  isBufferString,\n  hasTag,\n  stripTag,\n  extractInnerTag,\n  takeRight,\n} from './utils/utils'\n\nconst Defaults = {\n  apiKey: process.env.OPENAI_API_KEY || '',\n  baseURL: process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1',\n  providerName: 'openai',\n  model: 'gpt-4o-mini',\n  temperature: 0,\n  defaultEndpointCompletionSuffix: '/chat/completions',\n}\n\nexport class Micro {\n  private axiosInstance: AxiosInstance\n  private model: string\n  private systemPrompt: string\n  private messages: Message[]\n  private context: Record<string, any>\n  private prompt: string\n  private maxTokens?: number\n  private temperature?: number\n  private tools?: MicroOptions['tools']\n  private tool_choice?: MicroOptions['tool_choice']\n  private streaming: boolean\n  private parsedSystemPrompt: string\n  private defaultProvider: Omit<Provider, 'model'>\n  private modelName: string\n  private providerName: string\n  private identifier: string\n  private timeout?: number\n  private reasoning_effort?: ReasoningLevel\n\n  private onComplete?: MicroOptions['onComplete']\n  private onMessage?: MicroOptions['onMessage']\n  private onRequest?: MicroOptions['onRequest']\n  private onResponseData?: MicroOptions['onResponseData']\n  private onError?: MicroOptions['onError']\n  private onToolCall?: MicroOptions['onToolCall']\n\n  private debug: boolean\n\n  private reasoning: boolean\n  private isReasoningModel: boolean\n  private isGemini25Reasoning: boolean\n  private isOpenAIReasoning: boolean\n  private isOpenAI5: boolean\n  private isGLMReasoning: boolean\n  private isQWQ: boolean\n  private isDeepseekReasoning: boolean\n  private isQwen3: boolean\n\n  constructor(options: MicroOptions = {}) {\n    this.identifier = randomId()\n    this.timeout = options?.timeout\n\n    this.modelName = stripModelName(options?.model || '') || Defaults.model\n    this.providerName =\n      stripProviderName(options?.model || '') || Defaults.providerName\n\n    let providerConfig: Provider | undefined\n    if (this.providerName) {\n      const providerFn = Providers[this.providerName as keyof typeof Providers]\n      if (providerFn) {\n        providerConfig = providerFn(this.modelName)\n      }\n    }\n\n    this.defaultProvider = {\n      baseURL:\n        providerConfig?.baseURL ??\n        options?.provider?.baseURL ??\n        Defaults.baseURL,\n      apiKey:\n        providerConfig?.apiKey ?? options?.provider?.apiKey ?? Defaults.apiKey,\n      ...(options?.provider?.headers && {\n        headers: options.provider.headers,\n      }),\n    }\n\n    if (!this.defaultProvider.apiKey) {\n      throw new Error('API Key is required')\n    }\n\n    this.axiosInstance = axios.create({\n      baseURL: this.defaultProvider.baseURL,\n      headers: {\n        Authorization: `Bearer ${this.defaultProvider.apiKey}`,\n        'Content-Type': 'application/json',\n        ...this.defaultProvider.headers,\n      },\n      ...(this.timeout && {\n        timeout: this.timeout,\n      }),\n    })\n\n    this.model = this.modelName\n    this.systemPrompt = options?.systemPrompt || ''\n    this.prompt = options?.prompt || ''\n\n    this.context = options.context ?? {}\n    this.parsedSystemPrompt = this.systemPrompt\n      ? parseTemplate(this.systemPrompt, this.context)\n      : ''\n    this.maxTokens = options.maxTokens\n    this.temperature =\n      options.temperature !== undefined\n        ? options.temperature\n        : Defaults.temperature\n    this.tools = options.tools\n    this.tool_choice = options.tool_choice\n\n    this.debug = options?.debug || false\n    this.streaming = options?.streaming || false\n\n    this.reasoning = options?.reasoning ?? true\n    this.reasoning_effort = options.reasoning_effort ?? 'medium'\n\n    this.isOpenAI5 = this.model?.toLowerCase()?.includes('gpt-5')\n    this.isOpenAIReasoning =\n      this.model?.toLowerCase()?.includes('o1') ||\n      this.model?.toLowerCase()?.includes('o3') ||\n      this.model?.toLowerCase()?.includes('o4') ||\n      this.isOpenAI5\n\n    this.isGemini25Reasoning = this.model?.toLowerCase()?.includes('gemini-2.5')\n\n    this.isGLMReasoning = this.model?.toLowerCase()?.includes('glm-4.')\n    this.isQWQ = this.model?.toLowerCase()?.includes('qwq')\n    this.isDeepseekReasoning =\n      this.model?.toLowerCase()?.includes('deepseek-reasoner') ||\n      this.model?.toLowerCase()?.includes('deepseek-r1')\n    this.isQwen3 = this.model?.toLowerCase()?.includes('qwen3')\n\n    this.isReasoningModel =\n      this.isGemini25Reasoning ||\n      this.isOpenAIReasoning ||\n      this.isGLMReasoning ||\n      this.isQWQ ||\n      this.isDeepseekReasoning ||\n      this.isQwen3\n\n    this.onComplete = options.onComplete || undefined\n    this.onMessage = options.onMessage || undefined\n    this.onRequest = options.onRequest || undefined\n    this.onResponseData = options.onResponseData || undefined\n    this.onError = options.onError || undefined\n    this.onToolCall = options.onToolCall || undefined\n\n    this.messages = options?.messages ?? []\n    this.setSystemPrompt(this.parsedSystemPrompt)\n\n    if (this.debug) {\n      console.log('\\n=============================================')\n      console.log('Micro INFO:')\n      console.log('=============================================')\n      console.log('IDENTIFIER:      ', this.identifier)\n      console.log('MODEL NAME:      ', this.modelName)\n      console.log('PROVIDER NAME:   ', this.providerName)\n      console.log('DEFAULT PROVIDER ', this.defaultProvider)\n      console.log('=============================================\\n')\n    }\n  }\n\n  public getMetadata(): Metadata {\n    return {\n      id: this.identifier,\n      prompt: this.prompt,\n      providerName: this.providerName,\n      model: this.modelName,\n      timing: {\n        latencyMs: 0,\n        latencySeconds: 0,\n      },\n      timestamp: new Date().toISOString(),\n      context: this.context,\n      ...(this.isReasoningModel && {\n        isReasoningEnabled: this.reasoning,\n        isReasoningModel: this.isReasoningModel,\n        reasoning_effort: this.reasoning_effort,\n      }),\n    }\n  }\n\n  public getSystemPrompt(): string {\n    return this.parsedSystemPrompt\n  }\n\n  public setSystemPrompt(prompt: string): void {\n    if (!prompt) return\n    this.parsedSystemPrompt = parseTemplate(prompt, this.context)\n    if (this.parsedSystemPrompt && !this.getSystemMessage().length) {\n      this.messages.unshift({\n        role: 'system',\n        content: this.parsedSystemPrompt,\n      })\n    }\n  }\n\n  private getSystemMessage(): Message[] {\n    return this.messages.filter((msg) => msg.role === 'system')\n  }\n\n  private getNonSystemMessages(): Message[] {\n    return this.messages.filter((msg) => msg.role !== 'system')\n  }\n\n  public flushAllMessages(): void {\n    this.messages = []\n  }\n\n  public limitMessages(limit: number = 5): Message[] {\n    const systemPromptMessage = this.getSystemMessage()\n    const restOfMessages = this.getNonSystemMessages()\n    const limitMessages = takeRight(restOfMessages, limit)\n    const limitedHistory = [...systemPromptMessage, ...limitMessages]\n    this.messages = limitedHistory\n    return this.messages\n  }\n\n  public getMessages(): Message[] {\n    return this.messages\n  }\n\n  public setMessages(messages: Message[]): void {\n    this.messages = messages\n  }\n\n  public setUserMessage(prompt: string, bufferString?: string): void {\n    const parsedPrompt = parseTemplate(prompt, this.context)\n    this.prompt = parsedPrompt\n\n    if (bufferString && isBufferString(bufferString)) {\n      this.messages.push({\n        role: 'user',\n        content: [\n          {\n            type: 'text',\n            text: parsedPrompt,\n          },\n          {\n            type: 'image_url',\n            image_url: {\n              url: bufferString,\n            },\n          },\n        ],\n      })\n    } else {\n      this.messages.push({\n        role: 'user',\n        content: parsedPrompt,\n      })\n    }\n\n    if (this.onMessage) {\n      this.onMessage(this.messages)\n    }\n  }\n\n  public setAssistantMessage(prompt: string): this {\n    const parsedPrompt = parseTemplate(prompt, this.context)\n\n    this.messages.push({\n      role: 'assistant',\n      content: parsedPrompt,\n    })\n\n    if (this.onMessage) {\n      this.onMessage(this.messages)\n    }\n\n    return this\n  }\n\n  private async makeRequest(): Promise<any> {\n    const requestBody: any = {\n      model: this.model,\n      messages: this.messages,\n      stream: this.streaming,\n    }\n\n    if (this.temperature) {\n      requestBody.temperature = this.temperature\n    }\n\n    if (this.maxTokens) {\n      requestBody.max_tokens = this.maxTokens\n    }\n\n    if (this.tools && this.tools.length > 0) {\n      requestBody.tools = this.tools.map((tool) => tool.schema)\n      if (this.tool_choice) {\n        requestBody.tool_choice = this.tool_choice\n      }\n    }\n\n    if (this.reasoning && this.isReasoningModel) {\n      if (this.isOpenAIReasoning) {\n        requestBody.reasoning_effort = this.reasoning_effort\n        if (this.maxTokens) {\n          requestBody.max_completion_tokens = this.maxTokens\n          delete requestBody.max_tokens\n        }\n      } else if (this.isGemini25Reasoning) {\n        const thinkingBudgetMap: Record<ReasoningLevel, number> = {\n          minimal: 2048,\n          low: 4096,\n          medium: 8192,\n          high: 16384,\n        }\n        requestBody.extra_body = {\n          google: {\n            thinking_config: {\n              thinking_budget:\n                thinkingBudgetMap[this.reasoning_effort || 'medium'],\n              include_thoughts: true,\n            },\n          },\n        }\n      } else if (this.isGLMReasoning) {\n        requestBody.thinking = {\n          type: 'enabled',\n        }\n      }\n    }\n\n    if (this.onRequest) {\n      this.onRequest(requestBody)\n    }\n\n    const response = await this.axiosInstance.post(\n      Defaults.defaultEndpointCompletionSuffix,\n      requestBody\n    )\n\n    if (this.onResponseData) {\n      this.onResponseData(response.data)\n    }\n\n    return response.data\n  }\n\n  private async executeTool(\n    toolName: string,\n    toolArguments: string\n  ): Promise<any> {\n    const tool = this.tools?.find((t) => t.schema.function.name === toolName)\n\n    if (!tool) {\n      const errorMessage = `Tool \"${toolName}\" not found`\n      if (this.onToolCall) {\n        this.onToolCall({\n          toolName,\n          arguments: toolArguments,\n          result: null,\n          error: errorMessage,\n        })\n      }\n      return errorMessage\n    }\n\n    try {\n      const parsedArgs = JSON.parse(toolArguments)\n      const result = await tool.execute(parsedArgs)\n\n      if (this.onToolCall) {\n        this.onToolCall({\n          toolName,\n          arguments: parsedArgs,\n          result,\n        })\n      }\n\n      return result\n    } catch (error: any) {\n      const errorMessage = `Error executing tool \"${toolName}\": ${error.message}`\n      if (this.onToolCall) {\n        this.onToolCall({\n          toolName,\n          arguments: toolArguments,\n          result: null,\n          error: errorMessage,\n        })\n      }\n      return errorMessage\n    }\n  }\n\n  private async handleToolCalls(toolCalls: any[]): Promise<void> {\n    for (const toolCall of toolCalls) {\n      const toolName = toolCall.function.name\n      const toolArguments = toolCall.function.arguments\n\n      const result = await this.executeTool(toolName, toolArguments)\n\n      this.messages.push({\n        role: 'tool',\n        tool_call_id: toolCall.id,\n        name: toolName,\n        content: typeof result === 'string' ? result : JSON.stringify(result),\n      })\n    }\n\n    if (this.onMessage) {\n      this.onMessage(this.messages)\n    }\n  }\n\n  public async invoke(): Promise<Response> {\n    const startTime = Date.now()\n\n    try {\n      const responseData = await this.makeRequest()\n\n      const choice = responseData.choices?.[0]\n      const message = choice?.message\n\n      if (message) {\n        this.messages.push(message)\n\n        if (this.onMessage) {\n          this.onMessage(this.messages)\n        }\n      }\n\n      if (message?.tool_calls && message.tool_calls.length > 0) {\n        await this.handleToolCalls(message.tool_calls)\n        return this.invoke()\n      }\n\n      const endTime = Date.now()\n      const latencyMs = endTime - startTime\n\n      let reasoning = ''\n      let content = message?.content || ''\n      let hasThoughts = false\n\n      if (this.reasoning && this.isReasoningModel && content) {\n        if (hasTag(content, 'thinking')) {\n          reasoning = extractInnerTag(content, 'thinking')\n          content = stripTag(content, 'thinking')\n          hasThoughts = true\n        } else if (hasTag(content, 'think')) {\n          reasoning = extractInnerTag(content, 'think')\n          content = stripTag(content, 'think')\n          hasThoughts = true\n        }\n      }\n\n      const response: Response = {\n        metadata: {\n          id: this.identifier,\n          prompt: this.prompt,\n          providerName: this.providerName,\n          model: this.modelName,\n          tokensUsed: responseData.usage,\n          timing: {\n            latencyMs,\n            latencySeconds: latencyMs / 1000,\n          },\n          timestamp: new Date().toISOString(),\n          context: this.context,\n          ...(this.isReasoningModel && {\n            isReasoningEnabled: this.reasoning,\n            isReasoningModel: this.isReasoningModel,\n            reasoning_effort: this.reasoning_effort,\n            hasThoughts,\n          }),\n        },\n        completion: {\n          role: message?.role || 'assistant',\n          content: content.trim(),\n          reasoning: reasoning.trim(),\n          original: message?.content || '',\n        },\n      }\n\n      if (this.onComplete) {\n        this.onComplete(response, this.messages)\n      }\n\n      return response\n    } catch (error: any) {\n      const endTime = Date.now()\n      const latencyMs = endTime - startTime\n\n      const errorResponse: Response = {\n        metadata: {\n          id: this.identifier,\n          prompt: this.prompt,\n          providerName: this.providerName,\n          model: this.modelName,\n          timing: {\n            latencyMs,\n            latencySeconds: latencyMs / 1000,\n          },\n          timestamp: new Date().toISOString(),\n          context: this.context,\n        },\n        completion: {\n          role: 'assistant',\n          content: '',\n          original: '',\n        },\n        error: {\n          type: error.code === 'ECONNABORTED' ? 'timeout' : 'api_error',\n          message: error.message,\n          status: error.response?.status,\n          code: error.code,\n          details: error.response?.data,\n        },\n      }\n\n      if (this.onError) {\n        this.onError(errorResponse.error)\n      }\n\n      return errorResponse\n    }\n  }\n\n  public async chat(prompt: string, bufferString?: string): Promise<Response> {\n    this.setUserMessage(prompt, bufferString)\n    return this.invoke()\n  }\n}\n","import { type z } from 'zod'\nimport { zodToJsonSchema } from 'zod-to-json-schema'\n\nimport type { Tool } from '../types'\n\n/**\n * Creates a tool that can be used by agents to perform specific actions.\n *\n * @param name - The name of the tool\n * @param description - A description of what the tool does\n * @param schema - A trod schema defining the tool's parameters\n * @param executeFn - The function to execute when the tool is called\n * @returns A Tool object with schema and execute function\n *\n * @example\n * ```typescript\n * const weatherTool = createTool(\n *   \"get_weather\",\n *   \"Get the current weather for a location\",\n *   z.object({\n *     location: z.string().describe(\"The city and state, e.g. San Francisco, CA\"),\n *     unit: z.enum([\"celsius\", \"fahrenheit\"]).optional()\n *   }),\n *   async (params) => {\n *     return `Weather in ${params.location}: 72Â°F, sunny`;\n *   }\n * );\n * ```\n */\nexport function createTool<T extends z.ZodTypeAny, R>(\n  name: string,\n  description: string,\n  schema: T,\n  executeFn: (params: z.infer<T>) => Promise<R> | R\n): Tool {\n  const jsonSchema = zodToJsonSchema(schema as any, {\n    target: 'openApi3',\n    $refStrategy: 'none',\n  })\n\n  const properties = (jsonSchema as any).properties || {}\n  const required = (jsonSchema as any).required || []\n\n  return {\n    schema: {\n      type: 'function',\n      function: {\n        name,\n        description,\n        parameters: {\n          type: 'object',\n          properties,\n          required,\n          additionalProperties: false,\n        },\n      },\n    },\n    execute: executeFn,\n  }\n}\n","import dedent from 'dedent'\nimport { z } from 'zod'\nimport { Micro } from './client'\nimport type { MicroOptions, Tool, Message, Metadata, Response } from './types'\nimport { createTool } from './tools/create-tool'\nimport { slugify } from './utils/utils'\n\nconst SYSTEM_PROMPT = dedent`\nYou are a {{role}}. {{background}}\n\n## MAIN GOAL\n{{goal}}\n\n## TOOL HINTS\nYou have access to the following tools: {{toolsList}}.\n\n## ADDITIONAL INSTRUCTIONS\n{{additionalInstructions}}\n\nYou should think step by step in order to complete the task with reasoning divided in Thought/Action/Observation that can repeat multiple times if needed.\nYou should first reflect with '<thought>{your_thoughts}</thought>', then if necessary, use the tools to get the information you need and print your final response with '<final>{your_final_response}</final>'.\nMark your final response with '<final>{your_final_response}</final>' tag if you have finished the task and no longer need to use the tools.\nGo back and forth between the tools and the context until you have a complete understanding of the task.\nDo not repeat the same tool call in consecutive calls.\nNow begin! Reminder to ALWAYS use the exact characters <final>...<final/> when you provide a definitive answer.\n`\n\nexport interface AgentOptions extends Omit<MicroOptions, 'prompt'> {\n  name: string\n  instructions: string\n  handoffs?: Agent[]\n  position?: string\n}\n\nconst AgentDefaults = {\n  model: 'gpt-4o-mini',\n}\n\nexport class Agent {\n  private client: Micro\n  public name: string\n  public instructions: string\n  public handoffs?: Agent[]\n  public tools?: Tool[]\n  public position: string | undefined\n  public model: string | undefined\n\n  constructor(options: AgentOptions) {\n    this.name = options.name\n    this.instructions = options.instructions\n    this.handoffs = options.handoffs\n    this.tools = options.tools || []\n    this.position = options.position\n    this.model = options.model\n\n    const context = {\n      role: options.name,\n      background: options.instructions,\n      goal: options.instructions,\n      additionalInstructions: options.instructions,\n      toolsList: [\n        this.handoffAgentToStringList(this.handoffs || []),\n        this.toolsToStringList(this.tools || []),\n      ],\n      ...(options.context || {}),\n    }\n\n    this.client = new Micro({\n      systemPrompt: SYSTEM_PROMPT,\n      maxTokens: options.maxTokens || 4000,\n      temperature: options.temperature ?? 0,\n      model: this.model || AgentDefaults.model,\n      debug: options.debug || false,\n      context: context,\n      messages: options.messages,\n      reasoning: options.reasoning,\n      reasoning_effort: options.reasoning_effort,\n      timeout: options.timeout,\n      streaming: options.streaming,\n      tool_choice: options.tool_choice,\n      onComplete: options.onComplete,\n      onMessage: options.onMessage,\n      onRequest: options.onRequest,\n      onResponseData: options.onResponseData,\n      onError: options.onError,\n      onToolCall: options.onToolCall,\n      ...(this.handoffs && this.handoffs.length > 0\n        ? {\n            tools: [\n              ...(options.tools || []),\n              ...this.handoffAgentToTools(this.handoffs),\n            ],\n          }\n        : { tools: options.tools }),\n    })\n  }\n\n  private handoffAgentToTools(agents: Agent[]): Tool[] {\n    return agents.map((agent) =>\n      createTool(\n        slugify(agent.name),\n        `You are a ${agent.name}. Use this tool to ${agent.instructions}`,\n        z.object({\n          prompt: z.string().describe('The prompt of the request.'),\n        }),\n        async ({ prompt }) => {\n          const response = await agent.chat(prompt)\n          return response?.completion?.content || response\n        }\n      )\n    )\n  }\n\n  private toolsToStringList(tools: Tool[]): string {\n    if (!tools || tools.length === 0) {\n      return 'None'\n    }\n    return (\n      '\\n' +\n      tools\n        .map(\n          (tool) =>\n            `- ${tool.schema.function.name} [${slugify(tool.schema.function.name)}]: Its role is to ${\n              tool.schema.function.description\n            }`\n        )\n        .join('\\n')\n    )\n  }\n\n  private handoffAgentToStringList(agents: Agent[]): string {\n    if (!agents || agents.length === 0) {\n      return 'None'\n    }\n    return (\n      '\\n' +\n      agents\n        .map(\n          (agent) =>\n            `- ${agent.name} [${slugify(agent.name)}]: Its role is to ${\n              agent.instructions\n            }`\n        )\n        .join('\\n')\n    )\n  }\n\n  public async invoke(): Promise<Response> {\n    return this.client.invoke()\n  }\n\n  public async chat(prompt: string): Promise<Response> {\n    this.addPrompt(prompt)\n    return this.client.invoke()\n  }\n\n  public getMessages(): Message[] {\n    return this.client.getMessages()\n  }\n\n  public addPrompt(msg: string): void {\n    this.client.setUserMessage(msg)\n  }\n\n  public addAssistantPrompt(msg: string): void {\n    this.client.setAssistantMessage(msg)\n  }\n\n  public getMetadata(): Metadata {\n    return this.client.getMetadata()\n  }\n\n  public static create(options: AgentOptions): Agent {\n    return new Agent(options)\n  }\n}\n\nexport class Orchestrator extends Agent {\n  constructor(options: AgentOptions) {\n    super({ ...options, position: 'orchestrator' })\n  }\n\n  public static create(options: AgentOptions): Orchestrator {\n    return new Orchestrator({ ...options, position: 'orchestrator' })\n  }\n}\n"]}