{"version":3,"sources":["../src/client.ts","../src/providers.ts","../src/http.ts","../src/utils/utils.ts","../src/tools/create-tool.ts","../src/agent.ts"],"names":["createProvider","config","model","provider","Providers","http_exports","__export","del","get","head","httpClient","options","patch","post","put","METHODS_WITH_BODY","request","baseURL","endpoint","headers","body","timeout","method","stream","controller","timeoutId","fetchOptions","response","errorData","error","timeoutError","randomId","hyperid","parseTemplate","template","context","match","key","stripModelName","modelString","parts","stripProviderName","hasTag","content","tag","stripTag","openTagRegex","closeTagRegex","extractInnerTag","regex","isBufferString","str","slugify","text","takeRight","array","n","cleanEmptyList","item","sanitizeProvider","sanitized","firstCharacters","lastCharacters","total","prefix","suffix","maskedLength","Defaults","Micro","providerFn","providerConfig","modelLower","isOpenAI5","isOpenAIReasoning","v","isGemini25Reasoning","isGLMReasoning","isQWQ","isDeepseekReasoning","isQwen3","isMinimaxM2","prompt","hasSystemMessage","msg","limit","systemMessages","otherMessages","limitedMessages","messages","bufferString","parsedPrompt","enableStream","tool","thinkingBudgetMap","requestBody","data","toolName","toolArguments","t","errorMessage","parsedArgs","result","toolCalls","toolCall","message","reasoning","responseData","latencyMs","startTime","errorResponse","tokensUsed","reader","decoder","fullContent","role","buffer","done","value","lines","line","trimmedLine","parsed","delta","deltaReasoning","metadata","completion","finalResponse","createTool","name","description","schema","executeFn","jsonSchema","zodToJsonSchema","properties","required","SYSTEM_PROMPT_EXTRA","dedent","AgentDefaults","Agent","_Agent","sections","toolsText","agents","agent","z","tools","Orchestrator","_Orchestrator"],"mappings":"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","file":"index.cjs","sourcesContent":["import 'dotenv/config'\nimport type {\n  MicroOptions,\n  Message,\n  Provider,\n  ReasoningLevel,\n  Metadata,\n  Response,\n  StreamResponse,\n  MessageRole,\n  ModelCapabilities,\n  LlmParams,\n} from './types'\nimport { Providers } from './providers'\nimport { httpClient } from './http'\nimport {\n  randomId,\n  parseTemplate,\n  stripModelName,\n  stripProviderName,\n  isBufferString,\n  hasTag,\n  stripTag,\n  extractInnerTag,\n  takeRight,\n  sanitizeProvider,\n} from './utils/utils'\n\nconst Defaults = {\n  apiKey: process.env.OPENAI_API_KEY || '',\n  baseURL: process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1',\n  providerName: 'openai',\n  model: 'gpt-4.1-mini',\n  defaultEndpointCompletionSuffix: '/chat/completions',\n}\n\nexport class Micro {\n  private readonly identifier: string\n  private readonly baseURL: string\n  private readonly headers: Record<string, string>\n  private readonly model: string\n  private readonly modelName: string\n  private readonly providerName: string\n  private readonly defaultProvider: Omit<Provider, 'model'>\n  private readonly capabilities: ModelCapabilities\n  private readonly debug: boolean\n  private readonly streamEnabled: boolean\n  private readonly timeout?: number\n\n  private systemPrompt: string\n  private parsedSystemPrompt: string\n  private messages: Message[]\n  private context: Record<string, any>\n  private prompt: string\n  private maxTokens?: number\n  private temperature?: number\n  private tools?: MicroOptions['tools']\n  private tool_choice?: MicroOptions['tool_choice']\n  private reasoning: boolean\n  private reasoning_effort?: ReasoningLevel\n  private override?: LlmParams & Record<string, any>\n\n  private onComplete?: MicroOptions['onComplete']\n  private onMessage?: MicroOptions['onMessage']\n  private onRequest?: MicroOptions['onRequest']\n  private onResponseData?: MicroOptions['onResponseData']\n  private onError?: MicroOptions['onError']\n  private onToolCall?: MicroOptions['onToolCall']\n\n  constructor(options: MicroOptions = {}) {\n    this.identifier = randomId()\n    this.timeout = options.timeout\n    this.debug = options.debug ?? false\n    this.streamEnabled = options.stream ?? false\n\n    this.modelName = stripModelName(options.model || '') || Defaults.model\n    this.providerName =\n      stripProviderName(options.model || '') || Defaults.providerName\n    this.model = this.modelName\n\n    this.defaultProvider = this.initializeProvider(options)\n    this.baseURL = this.defaultProvider.baseURL\n    this.headers = this.buildHeaders()\n\n    this.capabilities = this.detectModelCapabilities()\n    this.reasoning = options.reasoning ?? this.capabilities.isReasoningModel\n    this.reasoning_effort = this.reasoning\n      ? (options.reasoning_effort ?? 'medium')\n      : undefined\n\n    this.systemPrompt = options.systemPrompt || ''\n    this.prompt = options.prompt || ''\n    this.context = options.context ?? {}\n    this.parsedSystemPrompt = this.systemPrompt\n      ? parseTemplate(this.systemPrompt, this.context)\n      : ''\n\n    this.maxTokens = options.maxTokens\n    this.temperature = options.temperature\n    this.tools = options.tools\n    this.tool_choice = options.tool_choice\n\n    this.override = options.override\n\n    this.onComplete = options.onComplete\n    this.onMessage = options.onMessage\n    this.onRequest = options.onRequest\n    this.onResponseData = options.onResponseData\n    this.onError = options.onError\n    this.onToolCall = options.onToolCall\n\n    this.messages = options.messages ?? []\n    this.setSystemPrompt(this.parsedSystemPrompt)\n\n    if (this.debug) this.logDebugInfo()\n  }\n\n  private initializeProvider(options: MicroOptions): Omit<Provider, 'model'> {\n    const providerFn = Providers[this.providerName as keyof typeof Providers]\n    const providerConfig = providerFn?.(this.modelName)\n\n    const provider = {\n      baseURL:\n        providerConfig?.baseURL ??\n        options.provider?.baseURL ??\n        Defaults.baseURL,\n      apiKey:\n        providerConfig?.apiKey ?? options.provider?.apiKey ?? Defaults.apiKey,\n      ...(options.provider?.headers && { headers: options.provider.headers }),\n    }\n\n    if (!provider.apiKey) {\n      throw new Error('API Key is required')\n    }\n\n    return provider\n  }\n\n  private buildHeaders(): Record<string, string> {\n    return {\n      Authorization: `Bearer ${this.defaultProvider.apiKey}`,\n      'Content-Type': 'application/json',\n      ...this.defaultProvider.headers,\n    }\n  }\n\n  private detectModelCapabilities(): ModelCapabilities {\n    const modelLower = this.model.toLowerCase()\n\n    const isOpenAI5 = modelLower.includes('gpt-5')\n    const isOpenAIReasoning =\n      ['o1', 'o3', 'o4'].some((v) => modelLower.includes(v)) || isOpenAI5\n    const isGemini25Reasoning = modelLower.includes('gemini-2.5')\n    const isGLMReasoning = modelLower.includes('glm-4.')\n    const isQWQ = modelLower.includes('qwq')\n    const isDeepseekReasoning =\n      modelLower.includes('deepseek-reasoner') ||\n      modelLower.includes('deepseek-r1')\n    const isQwen3 = modelLower.includes('qwen3')\n    const isMinimaxM2 = modelLower.includes('-m2')\n\n    const isReasoningModel =\n      isGemini25Reasoning ||\n      isOpenAIReasoning ||\n      isGLMReasoning ||\n      isQWQ ||\n      isDeepseekReasoning ||\n      isQwen3 ||\n      isMinimaxM2\n\n    return {\n      isOpenAI5,\n      isOpenAIReasoning,\n      isGemini25Reasoning,\n      isGLMReasoning,\n      isQWQ,\n      isDeepseekReasoning,\n      isQwen3,\n      isMinimaxM2,\n      isReasoningModel,\n    }\n  }\n\n  private logDebugInfo(): void {\n    console.log('\\n=============================================')\n    console.log('Micro INFO:')\n    console.log('=============================================')\n    console.log('IDENTIFIER:      ', this.identifier)\n    console.log('MODEL NAME:      ', this.modelName)\n    console.log('PROVIDER NAME:   ', this.providerName)\n    console.log('DEFAULT PROVIDER ', sanitizeProvider(this.defaultProvider))\n    console.log('=============================================\\n')\n  }\n\n  public getMetadata(): Metadata {\n    return {\n      id: this.identifier,\n      prompt: this.prompt,\n      providerName: this.providerName,\n      model: this.modelName,\n      timing: {\n        latencyMs: 0,\n        latencySeconds: 0,\n      },\n      timestamp: new Date().toISOString(),\n      context: this.context,\n      ...(this.capabilities.isReasoningModel && {\n        isReasoningEnabled: this.reasoning,\n        isReasoningModel: this.capabilities.isReasoningModel,\n        reasoning_effort: this.reasoning_effort,\n      }),\n    }\n  }\n\n  public getSystemPrompt(): string {\n    return this.parsedSystemPrompt\n  }\n\n  public setSystemPrompt(prompt: string): void {\n    if (!prompt) return\n    this.parsedSystemPrompt = parseTemplate(prompt, this.context)\n\n    const hasSystemMessage = this.messages.some((msg) => msg.role === 'system')\n    if (this.parsedSystemPrompt && !hasSystemMessage) {\n      this.messages.unshift({\n        role: 'system',\n        content: this.parsedSystemPrompt,\n      })\n    }\n  }\n\n  private getSystemMessage(): Message[] {\n    return this.messages.filter((msg) => msg.role === 'system')\n  }\n\n  private getNonSystemMessages(): Message[] {\n    return this.messages.filter((msg) => msg.role !== 'system')\n  }\n\n  public flushAllMessages(): void {\n    this.messages = []\n  }\n\n  public limitMessages(limit: number = 5): Message[] {\n    const systemMessages = this.getSystemMessage()\n    const otherMessages = this.getNonSystemMessages()\n    const limitedMessages = takeRight(otherMessages, limit)\n\n    this.messages = [...systemMessages, ...limitedMessages]\n    return this.messages\n  }\n\n  public getMessages(): Message[] {\n    return this.messages\n  }\n\n  public setMessages(messages: Message[]): void {\n    this.messages = messages\n  }\n\n  public setUserMessage(prompt: string, bufferString?: string): void {\n    const parsedPrompt = parseTemplate(prompt, this.context)\n    this.prompt = parsedPrompt\n\n    const content =\n      bufferString && isBufferString(bufferString)\n        ? [\n            { type: 'text' as const, text: parsedPrompt },\n            { type: 'image_url' as const, image_url: { url: bufferString } },\n          ]\n        : parsedPrompt\n\n    this.messages.push({ role: 'user', content })\n    this.onMessage?.(this.messages)\n  }\n\n  public setAssistantMessage(prompt: string): this {\n    const parsedPrompt = parseTemplate(prompt, this.context)\n    this.messages.push({ role: 'assistant', content: parsedPrompt })\n    this.onMessage?.(this.messages)\n    return this\n  }\n\n  private buildRequestBody(enableStream: boolean): Record<string, any> {\n    let body: Record<string, any> = {\n      model: this.model,\n      messages: this.messages,\n      stream: enableStream || this.streamEnabled,\n    }\n\n    if (this.temperature !== undefined) body.temperature = this.temperature\n    if (this.maxTokens) body.max_tokens = this.maxTokens\n\n    if (this.tools?.length) {\n      body.tools = this.tools.map((tool) => tool.schema)\n      if (this.tool_choice) body.tool_choice = this.tool_choice\n    }\n\n    if (this.reasoning && this.capabilities.isReasoningModel) {\n      this.applyReasoningConfig(body)\n    }\n    if (this.override) {\n      body = { ...body, ...this.override }\n    }\n\n    return body\n  }\n\n  private applyReasoningConfig(body: Record<string, any>): void {\n    if (this.capabilities.isOpenAIReasoning) {\n      body.reasoning_effort = this.reasoning_effort\n      if (this.maxTokens) {\n        body.max_completion_tokens = this.maxTokens\n        delete body.max_tokens\n      }\n    } else if (this.capabilities.isGemini25Reasoning) {\n      const thinkingBudgetMap: Record<ReasoningLevel, number> = {\n        minimal: 2048,\n        low: 4096,\n        medium: 8192,\n        high: 16384,\n      }\n      body.extra_body = {\n        google: {\n          thinking_config: {\n            thinking_budget:\n              thinkingBudgetMap[this.reasoning_effort || 'medium'],\n            include_thoughts: true,\n          },\n        },\n      }\n    } else if (this.capabilities.isGLMReasoning) {\n      body.thinking = { type: 'enabled' }\n    }\n  }\n\n  private async makeRequest(\n    enableStream: boolean = false\n  ): Promise<Record<string, any> | Response> {\n    const requestBody = this.buildRequestBody(enableStream)\n    this.onRequest?.(requestBody)\n\n    const data = await httpClient({\n      baseURL: this.baseURL,\n      endpoint: Defaults.defaultEndpointCompletionSuffix,\n      headers: this.headers,\n      body: requestBody,\n      timeout: this.timeout,\n      method: 'POST',\n      stream: enableStream || this.streamEnabled,\n    })\n\n    if (!enableStream) this.onResponseData?.(data)\n    return data\n  }\n\n  private async executeTool(\n    toolName: string,\n    toolArguments: string\n  ): Promise<any> {\n    const tool = this.tools?.find((t) => t.schema.function.name === toolName)\n\n    if (!tool) {\n      const errorMessage = `Tool \"${toolName}\" not found`\n      this.onToolCall?.({\n        toolName,\n        arguments: toolArguments,\n        result: null,\n        error: errorMessage,\n      })\n      return errorMessage\n    }\n\n    try {\n      const parsedArgs = JSON.parse(toolArguments)\n      const result = await tool.execute(parsedArgs)\n      this.onToolCall?.({ toolName, arguments: parsedArgs, result })\n      return result\n    } catch (error: any) {\n      const errorMessage = `Error executing tool \"${toolName}\": ${error.message}`\n      this.onToolCall?.({\n        toolName,\n        arguments: toolArguments,\n        result: null,\n        error: errorMessage,\n      })\n      return errorMessage\n    }\n  }\n\n  private async handleToolCalls(toolCalls: any[]): Promise<void> {\n    for (const toolCall of toolCalls) {\n      const result = await this.executeTool(\n        toolCall.function.name,\n        toolCall.function.arguments\n      )\n\n      this.messages.push({\n        role: 'tool',\n        tool_call_id: toolCall.id,\n        name: toolCall.function.name,\n        content: typeof result === 'string' ? result : JSON.stringify(result),\n      })\n\n      this.onMessage?.(this.messages)\n    }\n  }\n\n  private extractReasoning(message: any): {\n    reasoning: string\n    content: string\n  } {\n    let reasoning = message?.reasoning || message?.reasoning_content || ''\n    let content = message?.content || ''\n\n    if (hasTag(content, 'thinking')) {\n      reasoning = extractInnerTag(content, 'thinking')\n      content = stripTag(content, 'thinking')\n    } else if (hasTag(content, 'thought')) {\n      reasoning = extractInnerTag(content, 'thought')\n      content = stripTag(content, 'thought')\n    }\n\n    return { reasoning, content }\n  }\n\n  private buildResponse(\n    responseData: Record<string, any>,\n    latencyMs: number,\n    reasoning: string,\n    content: string,\n    message: any\n  ): Response {\n    return {\n      metadata: {\n        id: this.identifier,\n        prompt: this.prompt,\n        providerName: this.providerName,\n        model: this.modelName,\n        tokensUsed: responseData.usage,\n        timing: {\n          latencyMs,\n          latencySeconds: latencyMs / 1000,\n        },\n        timestamp: new Date().toISOString(),\n        context: this.context,\n        isReasoningEnabled: this.reasoning,\n        isReasoningModel:\n          this.capabilities.isReasoningModel || reasoning.length > 0,\n        reasoning_effort: this.reasoning_effort,\n        hasThoughts: reasoning.length > 0,\n      },\n      fullResponse: responseData,\n      completion: {\n        role: message?.role || 'assistant',\n        content: content.trim(),\n        reasoning: reasoning.trim(),\n        original: message?.content || '',\n      },\n    }\n  }\n\n  private buildErrorResponse(error: any, latencyMs: number): Response {\n    return {\n      metadata: {\n        id: this.identifier,\n        prompt: this.prompt,\n        providerName: this.providerName,\n        model: this.modelName,\n        timing: {\n          latencyMs,\n          latencySeconds: latencyMs / 1000,\n        },\n        timestamp: new Date().toISOString(),\n        context: this.context,\n      },\n      completion: {\n        role: 'assistant',\n        content: '',\n        original: '',\n      },\n      error: {\n        type: error.code === 'ECONNABORTED' ? 'timeout' : 'api_error',\n        message: error.message,\n        status: error.response?.status,\n        code: error.code,\n        details: error.response?.data,\n      },\n    }\n  }\n\n  public async invoke(): Promise<Response> {\n    const startTime = Date.now()\n\n    try {\n      const responseData = (await this.makeRequest()) as Record<string, any>\n      const message = responseData.choices?.[0]?.message\n\n      if (message) {\n        this.messages.push(message)\n        this.onMessage?.(this.messages)\n      }\n\n      if (message?.tool_calls?.length) {\n        await this.handleToolCalls(message.tool_calls)\n        return this.invoke()\n      }\n\n      const latencyMs = Date.now() - startTime\n      const { reasoning, content } = this.extractReasoning(message)\n      const response = this.buildResponse(\n        responseData,\n        latencyMs,\n        reasoning,\n        content,\n        message\n      )\n\n      this.onComplete?.(response, this.messages)\n      return response\n    } catch (error: any) {\n      const latencyMs = Date.now() - startTime\n      const errorResponse = this.buildErrorResponse(error, latencyMs)\n\n      this.onError?.(errorResponse.error)\n      return Promise.reject(errorResponse.error)\n    }\n  }\n\n  public async chat(prompt: string, bufferString?: string): Promise<Response> {\n    this.setUserMessage(prompt, bufferString)\n    return this.invoke()\n  }\n\n  private buildStreamMetadata(\n    latencyMs: number,\n    tokensUsed: any,\n    reasoning: string\n  ): Metadata {\n    return {\n      id: this.identifier,\n      prompt: this.prompt,\n      providerName: this.providerName,\n      model: this.modelName,\n      tokensUsed,\n      timing: {\n        latencyMs,\n        latencySeconds: latencyMs / 1000,\n      },\n      timestamp: new Date().toISOString(),\n      context: this.context,\n      isReasoningEnabled: this.reasoning,\n      isReasoningModel: this.capabilities.isReasoningModel,\n      reasoning_effort: this.reasoning_effort,\n      hasThoughts: reasoning.length > 0,\n    }\n  }\n\n  private async *processStream(\n    response: Response,\n    startTime: number\n  ): StreamResponse {\n    const reader = (response as any).body?.getReader()\n    if (!reader) throw new Error('Stream not available')\n\n    const decoder = new TextDecoder()\n    let fullContent = ''\n    let reasoning = ''\n    let role = 'assistant'\n    let buffer = ''\n    let tokensUsed: any = undefined\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read()\n        if (done) break\n\n        buffer += decoder.decode(value, { stream: true })\n        const lines = buffer.split('\\n')\n        buffer = lines.pop() || ''\n\n        for (const line of lines) {\n          const trimmedLine = line.trim()\n          if (!trimmedLine || trimmedLine === 'data: [DONE]') continue\n\n          if (trimmedLine.startsWith('data: ')) {\n            try {\n              const parsed = JSON.parse(trimmedLine.slice(6))\n              const delta = parsed.choices?.[0]?.delta\n\n              if (delta?.role) role = delta.role\n\n              const deltaReasoning =\n                delta?.reasoning || delta?.reasoning_content\n              if (delta?.content || deltaReasoning) {\n                fullContent += delta.content || ''\n                reasoning += deltaReasoning || ''\n\n                yield {\n                  delta: delta.content,\n                  reasoning: deltaReasoning,\n                  fullContent,\n                  done: false,\n                }\n              }\n\n              if (parsed.usage) tokensUsed = parsed.usage\n            } catch {\n              // Skip invalid JSON\n            }\n          }\n        }\n      }\n\n      this.messages.push({ role: role as MessageRole, content: fullContent })\n      this.onMessage?.(this.messages)\n\n      const latencyMs = Date.now() - startTime\n      const metadata = this.buildStreamMetadata(\n        latencyMs,\n        tokensUsed,\n        reasoning\n      )\n      const completion = {\n        role,\n        content: fullContent.trim(),\n        reasoning: reasoning.trim(),\n        original: fullContent,\n      }\n\n      const finalResponse: Response = { metadata, completion }\n      this.onComplete?.(finalResponse, this.messages)\n\n      yield {\n        delta: '',\n        fullContent: fullContent.trim(),\n        reasoning: reasoning.trim(),\n        done: true,\n        metadata,\n        completion,\n      }\n    } catch (error: any) {\n      const latencyMs = Date.now() - startTime\n      const errorResponse = this.buildErrorResponse(error, latencyMs)\n\n      this.onError?.(errorResponse.error)\n      throw errorResponse.error\n    }\n  }\n\n  public async stream(\n    prompt: string,\n    bufferString?: string\n  ): Promise<StreamResponse> {\n    this.setUserMessage(prompt, bufferString)\n    const startTime = Date.now()\n\n    try {\n      const response = await this.makeRequest(true)\n      return this.processStream(response as Response, startTime)\n    } catch (error: any) {\n      const latencyMs = Date.now() - startTime\n      const errorResponse = this.buildErrorResponse(error, latencyMs)\n\n      this.onError?.(errorResponse.error)\n      throw errorResponse.error\n    }\n  }\n}\n","import type { Provider } from './types'\n\n/**\n * Create a provider configuration object\n * Separates the model from the provider config for internal use\n */\nexport function createProvider(config: Provider): {\n  provider: Omit<Provider, 'model'>\n  model: string\n} {\n  const { model, ...provider } = config\n  return { provider, model }\n}\n\n/**\n * Built-in provider configurations\n * Each provider includes API endpoint, authentication, and default model\n */\nexport const Providers = {\n  openai: (model = 'gpt-4.1-mini'): Provider => ({\n    apiKey: process.env.OPENAI_API_KEY || '',\n    baseURL: process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1',\n    model,\n  }),\n\n  groq: (model = 'llama-3.3-70b-versatile'): Provider => ({\n    apiKey: process.env.GROQ_API_KEY || '',\n    baseURL: process.env.GROQ_BASE_URL || 'https://api.groq.com/openai/v1',\n    model,\n  }),\n\n  gemini: (model = 'gemini-2.5-flash-lite'): Provider => ({\n    apiKey: process.env.GEMINI_API_KEY || '',\n    baseURL:\n      process.env.GEMINI_BASE_URL ||\n      'https://generativelanguage.googleapis.com/v1beta/openai',\n    model,\n  }),\n\n  ai302: (model = 'gpt-4.1-mini'): Provider => ({\n    apiKey: process.env.AI_302_API_KEY || '',\n    baseURL: process.env.AI_302_BASE_URL || 'https://api.302.ai/v1',\n    model,\n  }),\n\n  openrouter: (model = 'openai/gpt-4.1-mini'): Provider => ({\n    apiKey: process.env.OPENROUTER_API_KEY || '',\n    baseURL: process.env.OPENROUTER_BASE_URL || 'https://openrouter.ai/api/v1',\n    model,\n  }),\n\n  deepseek: (model = 'deepseek-chat'): Provider => ({\n    apiKey: process.env.DEEPSEEK_API_KEY || '',\n    baseURL: process.env.DEEPSEEK_BASE_URL || 'https://api.deepseek.com/v1',\n    model,\n  }),\n\n  grok: (model = 'grok-4-fast'): Provider => ({\n    apiKey: process.env.GROK_API_KEY || '',\n    baseURL: process.env.GROK_BASE_URL || 'https://api.x.ai/v1',\n    model,\n  }),\n\n  fireworks: (\n    model = 'accounts/fireworks/models/llama4-maverick-instruct-basic'\n  ): Provider => ({\n    apiKey: process.env.FIREWORKS_API_KEY || '',\n    baseURL:\n      process.env.FIREWORKS_BASE_URL || 'https://api.fireworks.ai/inference/v1',\n    model,\n  }),\n\n  mistral: (model = 'mistral-large-latest'): Provider => ({\n    apiKey: process.env.MISTRAL_API_KEY || '',\n    baseURL: process.env.MISTRAL_BASE_URL || 'https://api.mistral.ai/v1',\n    model,\n  }),\n\n  together: (\n    model = 'meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo'\n  ): Provider => ({\n    apiKey: process.env.TOGETHER_API_KEY || '',\n    baseURL: process.env.TOGETHER_BASE_URL || 'https://api.together.xyz/v1',\n    model,\n  }),\n}\n","export type HttpMethod =\n  | 'get'\n  | 'GET'\n  | 'delete'\n  | 'DELETE'\n  | 'head'\n  | 'HEAD'\n  | 'options'\n  | 'OPTIONS'\n  | 'post'\n  | 'POST'\n  | 'put'\n  | 'PUT'\n  | 'patch'\n  | 'PATCH'\n\nexport interface HttpClientOptions {\n  baseURL: string\n  endpoint: string\n  headers: Record<string, string>\n  body?: Record<string, any>\n  timeout?: number\n  method?: HttpMethod\n  stream?: boolean\n}\n\nexport interface HttpError extends Error {\n  response?: {\n    status: number\n    data: any\n  }\n  code?: string\n}\n\nconst METHODS_WITH_BODY: HttpMethod[] = [\n  'POST',\n  'post',\n  'PUT',\n  'put',\n  'PATCH',\n  'patch',\n]\n\nasync function request<T = any>(options: HttpClientOptions): Promise<T> {\n  const {\n    baseURL,\n    endpoint,\n    headers,\n    body,\n    timeout,\n    method = 'POST',\n    stream = false,\n  } = options\n\n  const controller = new AbortController()\n  const timeoutId = timeout\n    ? setTimeout(() => controller.abort(), timeout)\n    : undefined\n\n  try {\n    const fetchOptions: RequestInit = {\n      method,\n      headers,\n      signal: controller.signal,\n    }\n\n    if (body && METHODS_WITH_BODY.includes(method)) {\n      fetchOptions.body = JSON.stringify(body)\n    }\n\n    const response = await fetch(`${baseURL}${endpoint}`, fetchOptions)\n\n    if (timeoutId) {\n      clearTimeout(timeoutId)\n    }\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}))\n      const error = new Error(\n        errorData.error?.message || `HTTP error! status: ${response.status}`\n      ) as HttpError\n      error.response = {\n        status: response.status,\n        data: errorData,\n      }\n      error.code = 'HTTP_ERROR'\n      throw error\n    }\n\n    if (stream) {\n      return response as T\n    }\n\n    return await response.json()\n  } catch (error: any) {\n    if (timeoutId) {\n      clearTimeout(timeoutId)\n    }\n\n    if (error.name === 'AbortError') {\n      const timeoutError = new Error('Request timeout') as HttpError\n      timeoutError.code = 'ECONNABORTED'\n      throw timeoutError\n    }\n\n    throw error\n  }\n}\n\nexport async function httpClient<T = any>(\n  options: HttpClientOptions\n): Promise<T> {\n  return request<T>(options)\n}\n\nexport async function get<T = any>(\n  options: Omit<HttpClientOptions, 'body' | 'method'>\n): Promise<T> {\n  return request<T>({ ...options, method: 'GET' })\n}\n\nexport async function post<T = any>(options: HttpClientOptions): Promise<T> {\n  return request<T>({ ...options, method: 'POST' })\n}\n\nexport async function put<T = any>(options: HttpClientOptions): Promise<T> {\n  return request<T>({ ...options, method: 'PUT' })\n}\n\nexport async function patch<T = any>(options: HttpClientOptions): Promise<T> {\n  return request<T>({ ...options, method: 'PATCH' })\n}\n\nexport async function del<T = any>(\n  options: Omit<HttpClientOptions, 'body' | 'method'>\n): Promise<T> {\n  return request<T>({ ...options, method: 'DELETE' })\n}\n\nexport async function head<T = any>(\n  options: Omit<HttpClientOptions, 'body' | 'method'>\n): Promise<T> {\n  return request<T>({ ...options, method: 'HEAD' })\n}\n\nexport async function options<T = any>(\n  options: Omit<HttpClientOptions, 'body' | 'method'>\n): Promise<T> {\n  return request<T>({ ...options, method: 'OPTIONS' })\n}\n","import hyperid from 'hyperid'\nimport { Provider } from '../types'\n\n/**\n * Generate a random ID using crypto.randomUUID\n */\nexport function randomId(): string {\n  const id = hyperid({ urlSafe: true })\n  return id()\n}\n\n/**\n * Parse template string and replace {{variable}} placeholders with context values\n * @param template - Template string with {{variable}} placeholders\n * @param context - Object containing variable values\n * @returns Parsed string with variables replaced\n */\nexport function parseTemplate(\n  template: string,\n  context: Record<string, any> = {}\n): string {\n  return template.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\n    return context[key] !== undefined ? String(context[key]) : match\n  })\n}\n\n/**\n * Extract model name from \"provider:model\" format\n * @param modelString - Full model string (e.g., \"openai:gpt-4.1-mini\",\"openai:gpt-4.1-mini:free\")\n * @returns Model name only (e.g., \"gpt-4o-mini\")\n */\nexport function stripModelName(modelString: string): string {\n  const parts = modelString.split(':')\n\n  if (parts.length === 2) {\n    return parts[1] || ''\n  }\n\n  if (parts.length === 3) {\n    return `${parts[1]}:${parts[2]}`\n  }\n\n  return modelString\n}\n\n/**\n * Extract provider name from \"provider:model\" format\n * @param modelString - Full model string (e.g., \"openai:gpt-4.1-mini\")\n * @returns Provider name only (e.g., \"openai\")\n */\nexport function stripProviderName(modelString: string): string {\n  const parts = modelString.split(':')\n  return parts.length > 1 ? (parts[0] ?? '') : ''\n}\n\n/**\n * Check if content contains a specific XML-style tag\n * @param content - Content to check\n * @param tag - Tag name to look for\n * @returns True if tag is found\n */\nexport function hasTag(content: string, tag: string): boolean {\n  const regex = new RegExp(`<${tag}>`, 'i')\n  return regex.test(content)\n}\n\n/**\n * Remove XML-style tags from content\n * @param content - Content with tags\n * @param tag - Tag name to remove\n * @returns Content without the specified tags\n */\nexport function stripTag(content: string, tag: string): string {\n  const openTagRegex = new RegExp(`<${tag}>`, 'gi')\n  const closeTagRegex = new RegExp(`</${tag}>`, 'gi')\n  return content.replace(openTagRegex, '').replace(closeTagRegex, '')\n}\n\n/**\n * Extract content within XML-style tags\n * @param content - Content with tags\n * @param tag - Tag name to extract\n * @returns Content within the tags, or empty string if not found\n */\nexport function extractInnerTag(content: string, tag: string): string {\n  const regex = new RegExp(`<${tag}>(.*?)</${tag}>`, 'is')\n  const match = content.match(regex)\n  return match && match[1] ? match[1].trim() : ''\n}\n\n/**\n * Check if a string is a base64-encoded buffer string (data URL)\n * @param str - String to check\n * @returns True if string is a buffer string\n */\nexport function isBufferString(str: string): boolean {\n  return str.startsWith('data:') && str.includes(';base64,')\n}\n\n/**\n * Detect MIME type from a buffer string (data URL)\n * @param bufferString - Base64 buffer string\n * @returns MIME type (e.g., \"image/png\") or empty string if not detected\n */\nexport function detectMimeTypeFromBufferString(bufferString: string): string {\n  if (!isBufferString(bufferString)) {\n    return ''\n  }\n\n  const match = bufferString.match(/^data:([^;]+);base64,/)\n  return match && match[1] ? match[1] : ''\n}\n\n/**\n * Convert a string to a URL-friendly slug\n * @param text - Text to slugify\n * @returns Slugified text (lowercase, hyphens, alphanumeric)\n */\nexport function slugify(text: string): string {\n  return text\n    .toLowerCase()\n    .trim()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/[\\s_-]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n}\n\n/**\n * Get the last n elements from an array\n * @param array - Array to take elements from\n * @param n - Number of elements to take from the end\n * @returns New array with the last n elements\n */\nexport function takeRight<T>(array: T[], n: number = 1): T[] {\n  if (n <= 0) return []\n  if (n >= array.length) return [...array]\n  return array.slice(-n)\n}\n\n/**\n * Remove empty strings from an array\n * @param array - Array of strings to filter\n * @returns New array with empty strings removed\n */\nexport function cleanEmptyList(array: string[]): string[] {\n  return array.filter((item) => item !== '')\n}\n\n/**\n * Log a labeled message with a visual separator\n * @param label - Label to display above the logged content\n * @param args - Arguments to log after the label and separator\n */\nexport function microlog(label: string, ...args: any[]): void {\n  console.log(`\\n${label}`)\n  console.log('='.repeat(50))\n  // console.log(JSON.stringify({ ...args }, null, 2))\n  console.log(...args)\n  console.log('='.repeat(50) + '\\n')\n}\n\n/**\n * Sanitize a provider object by masking sensitive API key information (in logs or CLI)\n * @param provider - Provider object without model property\n * @returns Sanitized provider object with masked API key\n */\nexport function sanitizeProvider(provider: Omit<Provider, 'model'>): any {\n  if (!provider) return provider\n\n  const sanitized = { ...provider }\n\n  if (sanitized.apiKey && typeof sanitized.apiKey === 'string') {\n    const key = sanitized.apiKey\n    // Show first 10 chars, mask the rest except last 8 chars\n    const firstCharacters = 10\n    const lastCharacters = 8\n    const total = firstCharacters + lastCharacters\n\n    if (key.length > total) {\n      const prefix = key.substring(0, firstCharacters)\n      const suffix = key.substring(key.length - lastCharacters)\n      const maskedLength = key.length - total\n      sanitized.apiKey = `${prefix}${''.repeat(maskedLength)}${suffix}`\n    } else if (key.length > firstCharacters) {\n      const prefix = key.substring(0, firstCharacters)\n      sanitized.apiKey = `${prefix}${''.repeat(key.length - firstCharacters)}`\n    } else {\n      sanitized.apiKey = ''.repeat(key.length)\n    }\n  }\n\n  return sanitized\n}\n","import { type z } from 'zod'\nimport { zodToJsonSchema } from 'zod-to-json-schema'\n\nimport type { Tool } from '../types'\n\n/**\n * Creates a tool that can be used by agents to perform specific actions.\n *\n * @param name - The name of the tool\n * @param description - A description of what the tool does\n * @param schema - A trod schema defining the tool's parameters\n * @param executeFn - The function to execute when the tool is called\n * @returns A Tool object with schema and execute function\n *\n * @example\n * ```typescript\n * const weatherTool = createTool(\n *   \"get_weather\",\n *   \"Get the current weather for a location\",\n *   z.object({\n *     location: z.string().describe(\"The city and state, e.g. San Francisco, CA\"),\n *     unit: z.enum([\"celsius\", \"fahrenheit\"]).optional()\n *   }),\n *   async (params) => {\n *     return `Weather in ${params.location}: 72F, sunny`;\n *   }\n * );\n * ```\n */\nexport function createTool<T extends z.ZodTypeAny, R>(\n  name: string,\n  description: string,\n  schema: T,\n  executeFn: (params: z.infer<T>) => Promise<R> | R\n): Tool {\n  const jsonSchema = zodToJsonSchema(schema as any, {\n    target: 'openApi3',\n    $refStrategy: 'none',\n  })\n\n  const properties = (jsonSchema as any).properties || {}\n  const required = (jsonSchema as any).required || []\n\n  return {\n    schema: {\n      type: 'function',\n      function: {\n        name,\n        description,\n        parameters: {\n          type: 'object',\n          properties,\n          required,\n          additionalProperties: false,\n        },\n      },\n    },\n    execute: executeFn,\n  }\n}\n","import dedent from 'dedent'\nimport { z } from 'zod'\nimport { Micro } from './client'\nimport type { MicroOptions, Tool, Message, Metadata, Response } from './types'\nimport { createTool } from './tools/create-tool'\nimport { cleanEmptyList, slugify } from './utils/utils'\n\nconst SYSTEM_PROMPT_EXTRA = dedent`\nYou should think step by step in order to complete the task with reasoning divided in Thought/Action/Observation that can repeat multiple times if needed.\nYou should first think about it, then if necessary, use the tools to get the information you need.\nGo back and forth between the tools and the context until you have a complete understanding of the task.\nDo not repeat the same tool call in consecutive calls.\nNow begin!\n`\n\nexport type AgentOptions = Omit<MicroOptions, 'prompt'> & {\n  name: string\n  background: string\n  goal?: string\n  position?: string\n  additionalInstructions?: string\n  handoffs?: Agent[]\n}\n\nconst AgentDefaults = {\n  model: 'gpt-4o-mini',\n}\n\nexport class Agent {\n  private client: Micro\n  public name: string\n  public background: string\n  public goal: string | undefined\n  public position: string | undefined\n  public handoffs?: Agent[]\n  public tools?: Tool[]\n  public model: string | undefined\n\n  constructor(options: AgentOptions) {\n    this.name = options.name\n    this.background = options.background\n    this.goal = options.goal\n    this.handoffs = options.handoffs || []\n    this.tools = options.tools || []\n    this.position = options.position\n    this.model = options.model\n\n    const context = {\n      role: options.name,\n      background: options.background,\n      goal: options.goal,\n      additionalInstructions: options.additionalInstructions,\n      toolsList: cleanEmptyList([\n        this.handoffAgentToStringList(this.handoffs),\n        this.toolsToStringList(this.tools),\n      ]),\n      ...(options.context || {}),\n    }\n\n    this.client = new Micro({\n      systemPrompt: this.buildSystemPrompt({\n        role: context.role,\n        background: context.background,\n        goal: context.goal,\n        additionalInstructions: context.additionalInstructions,\n        toolsList: context.toolsList || [],\n      }),\n      maxTokens: options.maxTokens || 4000,\n      temperature: options.temperature ?? 0,\n      model: this.model || AgentDefaults.model,\n      debug: options.debug || false,\n      context: context,\n      messages: options.messages,\n      reasoning: options.reasoning,\n      reasoning_effort: options.reasoning_effort,\n      timeout: options.timeout,\n      stream: options.stream,\n      tool_choice: options.tool_choice,\n      onComplete: options.onComplete,\n      onMessage: options.onMessage,\n      onRequest: options.onRequest,\n      onResponseData: options.onResponseData,\n      onError: options.onError,\n      onToolCall: options.onToolCall,\n      ...(this.handoffs && this.handoffs.length > 0\n        ? {\n            tools: [\n              ...(options.tools || []),\n              ...this.handoffAgentToTools(this.handoffs),\n            ],\n          }\n        : { tools: options.tools }),\n    })\n  }\n\n  private buildSystemPrompt(options: {\n    role?: string\n    background?: string\n    goal?: string\n    additionalInstructions?: string\n    toolsList?: string[]\n  }): string {\n    const sections: string[] = []\n\n    if (options?.role) {\n      sections.push(`# ROLE\\nYou are a ${options.role}.`)\n    }\n\n    if (options?.background) {\n      sections.push(`## BACKGROUND\\n${options.background}.`)\n    }\n\n    if (options?.goal) {\n      sections.push(`## MAIN GOAL\\n${options.goal}`)\n    }\n\n    if (options?.additionalInstructions) {\n      sections.push(\n        `## ADDITIONAL INSTRUCTIONS\\n${options.additionalInstructions}`\n      )\n    }\n\n    const toolsText = options?.toolsList?.length\n      ? options.toolsList.join(', ')\n      : '\\n - None provided'\n    sections.push(\n      `## TOOL HINTS\\nYou have access to the following tools: ${toolsText}`\n    )\n\n    sections.push(SYSTEM_PROMPT_EXTRA)\n\n    return sections.join('\\n\\n')\n  }\n\n  private handoffAgentToTools(agents: Agent[]): Tool[] {\n    return agents.map((agent) =>\n      createTool(\n        slugify(agent.name),\n        dedent`You are a ${agent.name}. Use this tool to ${agent.goal ?? agent.background}`,\n        z.object({\n          prompt: z.string().describe('The prompt of the request.'),\n        }),\n        async ({ prompt }) => {\n          const response = await agent.chat(prompt)\n          return response?.completion?.content || response\n        }\n      )\n    )\n  }\n\n  private toolsToStringList(tools: Tool[]): string {\n    if (!tools || tools.length === 0) {\n      return ''\n    }\n    return (\n      '\\n' +\n      tools\n        .map(\n          (tool) =>\n            `- ${tool.schema.function.name} [${slugify(tool.schema.function.name)}]: Its role is to ${\n              tool.schema.function.description\n            }`\n        )\n        .join('\\n')\n    )\n  }\n\n  private handoffAgentToStringList(agents: Agent[]): string {\n    if (!agents || agents.length === 0) {\n      return ''\n    }\n    return (\n      '\\n' +\n      agents\n        .map(\n          (agent) =>\n            `- ${agent.name} [${slugify(agent.name)}]: Its role is to ${\n              agent.background\n            }`\n        )\n        .join('\\n')\n    )\n  }\n\n  public async invoke(): Promise<Response> {\n    return this.client.invoke()\n  }\n\n  public async chat(prompt: string): Promise<Response> {\n    this.addPrompt(prompt)\n    return this.client.invoke()\n  }\n\n  public getMessages(): Message[] {\n    return this.client.getMessages()\n  }\n\n  public addPrompt(msg: string): void {\n    this.client.setUserMessage(msg)\n  }\n\n  public addAssistantPrompt(msg: string): void {\n    this.client.setAssistantMessage(msg)\n  }\n\n  public getMetadata(): Metadata {\n    return this.client.getMetadata()\n  }\n\n  public static create(options: AgentOptions): Agent {\n    return new Agent(options)\n  }\n}\n\nexport class Orchestrator extends Agent {\n  constructor(options: AgentOptions) {\n    super({ ...options, position: 'orchestrator' })\n  }\n\n  public static create(options: AgentOptions): Orchestrator {\n    return new Orchestrator({ ...options, position: 'orchestrator' })\n  }\n}\n"]}